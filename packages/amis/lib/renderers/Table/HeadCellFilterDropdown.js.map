{
    "version": 3,
    "file": "HeadCellFilterDropdown.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Table/HeadCellFilterDropdown.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport {Api} from '../../types';\nimport {RendererProps} from '../../factory';\nimport {isApiOutdated, isEffectiveApi, normalizeApi} from '../../utils/api';\nimport {Icon} from '../../components/icons';\nimport Overlay from '../../components/Overlay';\nimport PopOver from '../../components/PopOver';\nimport {findDOMNode} from 'react-dom';\nimport Checkbox from '../../components/Checkbox';\nimport xor from 'lodash/xor';\nimport {normalizeOptions} from '../../components/Select';\nimport {getVariable} from '../../utils/helper';\n\nexport interface QuickFilterConfig {\n  options: Array<any>;\n  source: Api;\n  multiple: boolean;\n  [propName: string]: any;\n}\n\nexport interface HeadCellFilterProps extends RendererProps {\n  data: any;\n  name: string;\n  filterable: QuickFilterConfig;\n  onQuery: (values: object) => void;\n}\n\nexport class HeadCellFilterDropDown extends React.Component<\n  HeadCellFilterProps,\n  any\n> {\n  state = {\n    isOpened: false,\n    filterOptions: []\n  };\n\n  sourceInvalid: boolean = false;\n  constructor(props: HeadCellFilterProps) {\n    super(props);\n\n    this.open = this.open.bind(this);\n    this.close = this.close.bind(this);\n    this.handleClick = this.handleClick.bind(this);\n    this.handleCheck = this.handleCheck.bind(this);\n  }\n\n  componentDidMount() {\n    const {filterable, name, store} = this.props;\n\n    if (filterable.source) {\n      this.fetchOptions();\n    } else if (filterable.options?.length > 0) {\n      this.setState({\n        filterOptions: this.alterOptions(filterable.options)\n      });\n    }\n  }\n\n  componentDidUpdate(prevProps: HeadCellFilterProps, prevState: any) {\n    const name = this.props.name;\n\n    const props = this.props;\n\n    if (\n      prevProps.name !== props.name ||\n      prevProps.filterable !== props.filterable ||\n      prevProps.data !== props.data\n    ) {\n      if (props.filterable.source) {\n        this.sourceInvalid = isApiOutdated(\n          prevProps.filterable.source,\n          props.filterable.source,\n          prevProps.data,\n          props.data\n        );\n      } else if (props.filterable.options) {\n        this.setState({\n          filterOptions: this.alterOptions(props.filterable.options || [])\n        });\n      } else if (\n        name &&\n        !this.state.filterOptions.length &&\n        (Array.isArray(props.store?.data.itemsRaw) ||\n          Array.isArray(props.store?.data.items))\n      ) {\n        const itemsRaw = props.store?.data.itemsRaw || props.store?.data.items;\n        const values: Array<any> = [];\n        itemsRaw.forEach((item: any) => {\n          const value = getVariable(item, name);\n\n          if (!~values.indexOf(value)) {\n            values.push(value);\n          }\n        });\n\n        if (values.length) {\n          this.setState({\n            filterOptions: this.alterOptions(values)\n          });\n        }\n      }\n    }\n\n    if (\n      this.props.data[name] !== prevProps.data[name] &&\n      this.state.filterOptions.length &&\n      prevState.filterOptions !== this.props.filterOptions\n    ) {\n      this.setState({\n        filterOptions: this.alterOptions(this.state.filterOptions)\n      });\n    }\n\n    this.sourceInvalid && this.fetchOptions();\n  }\n\n  fetchOptions() {\n    const {env, filterable, data} = this.props;\n\n    if (!isEffectiveApi(filterable.source, data)) {\n      return;\n    }\n\n    const api = normalizeApi(filterable.source);\n    api.cache = 3000; // 开启 3s 缓存，因为固顶位置渲染1次会额外多次请求。\n\n    env.fetcher(api, data).then(ret => {\n      let options = (ret.data && ret.data.options) || [];\n      this.setState({\n        filterOptions: ret && ret.data && this.alterOptions(options)\n      });\n    });\n  }\n\n  alterOptions(options: Array<any>) {\n    const {data, filterable, name} = this.props;\n    const filterValue =\n      data && typeof data[name] !== 'undefined' ? data[name] : '';\n    options = normalizeOptions(options);\n\n    if (filterable.multiple) {\n      options = options.map(option => ({\n        ...option,\n        selected: filterValue.split(',').indexOf(option.value) > -1\n      }));\n    } else {\n      options = options.map(option => ({\n        ...option,\n        selected: option.value == filterValue\n      }));\n    }\n    return options;\n  }\n\n  handleClickOutside() {\n    this.close();\n  }\n\n  open() {\n    this.setState({\n      isOpened: true\n    });\n  }\n\n  close() {\n    this.setState({\n      isOpened: false\n    });\n  }\n\n  handleClick(value: string) {\n    const {onQuery, name} = this.props;\n\n    onQuery({\n      [name]: value\n    });\n    this.close();\n  }\n\n  handleCheck(value: string) {\n    const {data, name, onQuery} = this.props;\n    let query: string;\n\n    if (data[name] && data[name] === value) {\n      query = '';\n    } else {\n      query =\n        (data[name] && xor(data[name].split(','), [value]).join(',')) || value;\n    }\n\n    onQuery({\n      [name]: query\n    });\n  }\n\n  handleReset() {\n    const {name, onQuery} = this.props;\n    onQuery({\n      [name]: undefined\n    });\n    this.close();\n  }\n\n  render() {\n    const {isOpened, filterOptions} = this.state;\n    const {\n      data,\n      name,\n      filterable,\n      popOverContainer,\n      classPrefix: ns,\n      classnames: cx,\n      translate: __\n    } = this.props;\n\n    return (\n      <span\n        className={cx(\n          `${ns}TableCell-filterBtn`,\n          typeof data[name] !== 'undefined' ? 'is-active' : ''\n        )}\n      >\n        <span onClick={this.open}>\n          <Icon icon=\"column-filter\" className=\"icon\" />\n        </span>\n        {isOpened ? (\n          <Overlay\n            container={popOverContainer || (() => findDOMNode(this))}\n            placement=\"left-bottom-left-top right-bottom-right-top\"\n            target={\n              popOverContainer ? () => findDOMNode(this)!.parentNode : null\n            }\n            show\n          >\n            <PopOver\n              classPrefix={ns}\n              onHide={this.close}\n              className={cx(\n                `${ns}TableCell-filterPopOver`,\n                (filterable as any).className\n              )}\n              overlay\n            >\n              {filterOptions && filterOptions.length > 0 ? (\n                <ul className={cx('DropDown-menu')}>\n                  {!filterable.multiple\n                    ? filterOptions.map((option: any, index) => (\n                        <li\n                          key={index}\n                          className={cx({\n                            'is-active': option.selected\n                          })}\n                          onClick={this.handleClick.bind(this, option.value)}\n                        >\n                          {option.label}\n                        </li>\n                      ))\n                    : filterOptions.map((option: any, index) => (\n                        <li key={index}>\n                          <Checkbox\n                            classPrefix={ns}\n                            onChange={this.handleCheck.bind(this, option.value)}\n                            checked={option.selected}\n                          >\n                            {option.label}\n                          </Checkbox>\n                        </li>\n                      ))}\n                  {filterOptions.some((item: any) => item.selected) ? (\n                    <li\n                      key=\"DropDown-menu-reset\"\n                      onClick={this.handleReset.bind(this)}\n                    >\n                      {__('reset')}\n                    </li>\n                  ) : null}\n                </ul>\n              ) : null}\n            </PopOver>\n          </Overlay>\n        ) : null}\n      </span>\n    );\n  }\n}\n"
    ]
}