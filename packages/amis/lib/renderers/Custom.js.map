{
    "version": 3,
    "file": "Custom.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Custom.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport ReactDOM from 'react-dom';\nimport memoize from 'lodash/memoize';\nimport isString from 'lodash/isString';\nimport {Renderer, RendererProps} from '../factory';\nimport {BaseSchema} from '../Schema';\nimport {FormControlProps} from './Form/Item';\nimport isEqual from 'lodash/isEqual';\n\n/**\n * 自定义组件\n */\nexport interface CustomSchema extends BaseSchema {\n  /**\n   * 实现自定义功能的渲染器，主要给 JS SDK 和可视化编辑器里使用。\n   *\n   * 文档：https://baidu.gitee.io/amis/components/custom\n   */\n  type: 'custom';\n  onMount?: Function | string;\n  onUpdate?: Function | string;\n  onUnmount?: Function | string;\n  inline?: boolean;\n  id?: string;\n  html?: string;\n}\n\nexport interface CustomProps extends FormControlProps, CustomSchema {\n  className?: string;\n  value?: any;\n  wrapperComponent?: any;\n  inline?: boolean;\n}\n\n// 添加resolver，指定所有参数的联合字符串为key。因为最后一个参数为函数体\n// 缓存一下，避免在 crud 中的自定义组件被大量执行\nconst getFunction = memoize(\n  (...args) => {\n    return new Function(...args);\n  },\n  (...args) => JSON.stringify(args)\n);\n\nexport class Custom extends React.Component<CustomProps, object> {\n  static defaultProps: Partial<CustomProps> = {\n    inline: false\n  };\n\n  dom: any;\n  onUpdate: Function = () => {};\n  onMount: Function = () => {};\n  onUnmount: Function = () => {};\n\n  childElemArr: HTMLElement[] = []; // 用于记录子元素的Dom节点，以便销毁\n\n  constructor(props: CustomProps) {\n    super(props);\n    this.dom = React.createRef();\n    this.initOnMount(props);\n    this.initOnUpdate(props);\n    this.initOnUnmount(props);\n    this.renderChild = this.renderChild.bind(this);\n    this.recordChildElem = this.recordChildElem.bind(this);\n    this.unmountChildElem = this.unmountChildElem.bind(this);\n  }\n\n  initOnMount(props: CustomProps) {\n    if (props.onMount) {\n      if (typeof props.onMount === 'string') {\n        this.onMount = getFunction(\n          'dom',\n          'value',\n          'onChange',\n          'props',\n          props.onMount\n        );\n      } else {\n        this.onMount = props.onMount;\n      }\n    }\n  }\n\n  initOnUpdate(props: CustomProps) {\n    if (props.onUpdate) {\n      if (typeof props.onUpdate === 'string') {\n        this.onUpdate = getFunction(\n          'dom',\n          'data',\n          'prevData',\n          'props',\n          props.onUpdate\n        );\n      } else {\n        this.onUpdate = props.onUpdate;\n      }\n    }\n  }\n\n  initOnUnmount(props: CustomProps) {\n    if (props.onUnmount) {\n      if (typeof props.onUnmount === 'string') {\n        this.onUnmount = getFunction('props', props.onUnmount);\n      } else {\n        this.onUnmount = props.onUnmount;\n      }\n    }\n  }\n\n  componentDidUpdate(prevProps: CustomProps) {\n    if (!isEqual(this.props.onUpdate, prevProps.onUpdate)) {\n      this.initOnUpdate(this.props);\n    }\n    if (!isEqual(this.props.onUpdate, prevProps.onUpdate) || !isEqual(this.props.data, prevProps.data)) {\n      this.onUpdate(this.dom, this.props.data, prevProps.data, this.props);\n    }\n    if (!isEqual(this.props.onMount, prevProps.onMount)) {\n      this.initOnMount(this.props);\n    }\n    if (!isEqual(this.props.onUnmount, prevProps.onUnmount)) {\n      this.initOnUnmount(this.props);\n    }\n  }\n\n  componentDidMount() {\n    const {value, onChange} = this.props;\n    this.onMount(this.dom.current, value, onChange, this.props);\n  }\n\n  componentWillUnmount() {\n    this.onUnmount(this.props);\n    // 自动销毁所有子节点\n    this.unmountChildElem();\n  }\n\n  // 记录子元素的dom节点\n  recordChildElem(insertElem: HTMLElement) {\n    if (insertElem && !this.childElemArr.some(item => item === insertElem)) {\n      this.childElemArr.push(insertElem);\n    }\n  }\n\n  // 销毁所有子元素的dom节点\n  unmountChildElem() {\n    if (this.childElemArr && this.childElemArr.length > 0) {\n      this.childElemArr.forEach(childElemItem =>\n        ReactDOM.unmountComponentAtNode(childElemItem)\n      );\n    }\n  }\n\n  /**\n   * 渲染子元素\n   * 备注：现有custom组件通过props.render生成的子元素是react虚拟dom对象，需要使用ReactDOM.render渲染，不能直接插入到当前dom中。\n   **/\n  renderChild(\n    schemaPosition: string,\n    childSchema: any,\n    insertElemDom: HTMLElement | string\n  ) {\n    const {render} = this.props;\n    let childEleCont = null;\n    let curInsertElemDom: any = null;\n    if (isString(insertElemDom)) {\n      const _curInsertElem = document.getElementById(insertElemDom);\n      if (_curInsertElem) {\n        curInsertElemDom = _curInsertElem as HTMLElement;\n      }\n    } else {\n      curInsertElemDom = insertElemDom;\n    }\n    if (childSchema && curInsertElemDom) {\n      const childHTMLElem = render(schemaPosition, childSchema);\n      childEleCont = ReactDOM.render(childHTMLElem, curInsertElemDom, () => {\n        this.recordChildElem(curInsertElemDom);\n      });\n    }\n    return childEleCont;\n  }\n\n  render() {\n    const {\n      className,\n      html,\n      id,\n      wrapperComponent,\n      inline,\n      translate: __,\n      classnames: cx\n    } = this.props;\n    const Component = wrapperComponent || inline ? 'span' : 'div';\n    return (\n      <Component\n        ref={this.dom}\n        className={cx(className)}\n        id={id}\n        dangerouslySetInnerHTML={{__html: html ? html : ''}}\n      ></Component>\n    );\n  }\n}\n\n@Renderer({\n  type: 'custom'\n})\nexport class CustomRenderer extends Custom {}\n"
    ]
}