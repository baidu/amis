{
    "version": 3,
    "file": "Log.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Log.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "/**\n * @file 用于显示日志的组件，比如显示命令行的输出结果\n */\nimport React from 'react';\nimport {Renderer, RendererProps} from '../factory';\nimport {BaseSchema} from '../Schema';\nimport Ansi from 'ansi-to-react';\nimport {buildApi, isApiOutdated} from '../utils/api';\nimport VirtualList from '../components/virtual-list';\nimport Button from '../components/Button';\nimport {\n  InputClearIcon,\n  LeftArrowIcon,\n  MinusIcon,\n  PauseIcon,\n  PlusIcon,\n  ReloadIcon,\n  RightArrowIcon\n} from '../components/icons';\n\nexport type LogOperation = 'stop' | 'restart' | 'showLineNumber' | 'clear';\n\n/**\n * 日志展示组件\n * 文档：https://baidu.gitee.io/amis/docs/components/log\n */\nexport interface LogSchema extends BaseSchema {\n  /**\n   * 指定为 log 链接展示控件\n   */\n  type: 'log';\n\n  /**\n   * 自定义 CSS 类名\n   */\n  className?: string;\n\n  /**\n   * 获取日志的地址\n   */\n  source: string;\n\n  /**\n   * 控件高度\n   */\n  height?: number;\n\n  /**\n   * 是否自动滚动到最底部\n   */\n  autoScroll?: boolean;\n\n  /**\n   * 返回内容字符编码\n   */\n  encoding?: string;\n\n  /**\n   * 限制最大日志数量\n   */\n  maxLength?: number;\n\n  /**\n   * 每行高度\n   */\n  rowHeight?: number;\n\n  /**\n   * 关闭 ANSI 颜色支持\n   */\n  disableColor?: boolean;\n\n  /**\n   * 一些可操作选项\n   */\n  operation?: Array<LogOperation>;\n}\n\nexport interface LogProps\n  extends RendererProps,\n    Omit<LogSchema, 'type' | 'className'> {}\n\nexport interface LogState {\n  lastLine: string;\n  logs: string[];\n  refresh: boolean;\n  showLineNumber: boolean;\n  showOperation: boolean;\n}\n\nexport class Log extends React.Component<LogProps, LogState> {\n  static defaultProps = {\n    height: 500,\n    autoScroll: true,\n    placeholder: 'loading',\n    encoding: 'utf-8'\n  };\n\n  isDone: boolean = false;\n\n  autoScroll: boolean = false;\n\n  logRef: React.RefObject<HTMLDivElement>;\n\n  state: LogState = {\n    lastLine: '',\n    logs: [],\n    refresh: true,\n    showLineNumber: false,\n    showOperation: false\n  };\n\n  constructor(props: LogProps) {\n    super(props);\n    this.logRef = React.createRef();\n    this.autoScroll = props.autoScroll || false;\n    this.pauseOrResumeScrolling = this.pauseOrResumeScrolling.bind(this);\n  }\n\n  componentWillUnmount() {\n    if (this.logRef && this.logRef.current) {\n      this.logRef.current.removeEventListener(\n        'scroll',\n        this.pauseOrResumeScrolling\n      );\n    }\n  }\n\n  componentDidMount() {\n    if (this.autoScroll && this.logRef && this.logRef.current) {\n      this.logRef.current.addEventListener(\n        'scroll',\n        this.pauseOrResumeScrolling\n      );\n    }\n    if (this.props.source) {\n      this.loadLogs();\n    }\n  }\n\n  componentDidUpdate(prevProps: LogProps) {\n    if (this.autoScroll && this.logRef && this.logRef.current) {\n      this.logRef.current.scrollTop = this.logRef.current.scrollHeight;\n    }\n    if (\n      isApiOutdated(\n        prevProps.source,\n        this.props.source,\n        prevProps.data,\n        this.props.data\n      )\n    ) {\n      this.loadLogs();\n    }\n  }\n\n  // 如果向上滚动就停止自动滚动，除非滚到底部\n  pauseOrResumeScrolling() {\n    if (this.logRef && this.logRef.current) {\n      const {scrollHeight, scrollTop, offsetHeight} = this.logRef.current;\n      this.autoScroll = scrollHeight - (scrollTop + offsetHeight) < 50;\n    }\n  }\n\n  refresh = () => {\n    let origin = this.state.refresh;\n    this.setState({\n      refresh: !origin\n    });\n    if (!origin) {\n      this.clear();\n      this.loadLogs();\n    }\n  };\n\n  clear = () => {\n    this.setState({\n      logs: [],\n      lastLine: ''\n    });\n  };\n\n  changeShowLineNumber = () => {\n    this.setState({\n      showLineNumber: !this.state.showLineNumber\n    });\n  };\n\n  changeShowOperation = () => {\n    this.setState({\n      showOperation: !this.state.showOperation\n    });\n  };\n\n  async loadLogs() {\n    const {source, data, env, translate: __, encoding, maxLength} = this.props;\n    // 因为这里返回结果是流式的，和普通 api 请求不一样，如果直接用 fetcher 经过 responseAdaptor 可能会导致出错，所以就直接 fetch 了\n    const api = buildApi(source, data);\n    if (!api.url) {\n      return;\n    }\n    const res = await fetch(api.url, {\n      method: api.method?.toLocaleUpperCase() || 'GET',\n      headers: (api.headers as Record<string, string>) || undefined,\n      body: api.data ? JSON.stringify(api.data) : undefined,\n      credentials: 'include'\n    });\n    if (res.status === 200) {\n      const body = res.body;\n      if (!body) {\n        return;\n      }\n      const reader = body.getReader();\n      let lastline = '';\n      let logs: string[] = [];\n      for (;;) {\n        if (!this.state.refresh) {\n          await reader.cancel('click cancel button').then(() => {\n            this.props.env.notify('success', '日志已经停止刷新');\n            return;\n          });\n        }\n        let {done, value} = await reader.read();\n        if (value) {\n          let text = new TextDecoder(encoding).decode(value, {stream: true});\n          // 不考虑只有 \\r 换行符的情况，几乎没人用\n          const lines = text.split('\\n');\n          // 如果没有换行符就只更新最后一行\n          if (lines.length === 1) {\n            lastline += lines[0];\n            this.setState({\n              lastLine: lastline\n            });\n          } else {\n            // 将之前的数据补上\n            lines[0] = lastline + lines[0];\n            // 最后一个要么是空，要么是下一行的数据\n            lastline = lines.pop() || '';\n            if (maxLength) {\n              if (logs.length + lines.length > maxLength) {\n                logs.splice(0, logs.length + lines.length - maxLength);\n              }\n            }\n            logs = logs.concat(lines);\n            this.setState({\n              logs: logs,\n              lastLine: lastline\n            });\n          }\n        }\n\n        if (done) {\n          this.isDone = true;\n          return;\n        }\n      }\n    } else {\n      env.notify('error', __('fetchFailed'));\n    }\n  }\n\n  /**\n   * 渲染某一行\n   */\n  renderLine(index: number, line: string, showLineNumber: boolean) {\n    const {classnames: cx, disableColor} = this.props;\n    return (\n      <div className={cx('Log-line')} key={index}>\n        {showLineNumber && (\n          <span className={cx('Log-line-number')}>{index + 1} </span>\n        )}\n        {disableColor ? line : <Ansi useClasses>{line}</Ansi>}\n      </div>\n    );\n  }\n\n  render() {\n    const {\n      source,\n      className,\n      classnames: cx,\n      placeholder,\n      height,\n      rowHeight,\n      disableColor,\n      translate: __,\n      operation,\n      env\n    } = this.props;\n\n    const {refresh, showLineNumber, showOperation} = this.state;\n\n    let loading = __(placeholder);\n\n    if (!source) {\n      loading = __('Log.mustHaveSource');\n    }\n    let lines: any;\n\n    const logs = this.state.lastLine\n      ? this.state.logs.concat([this.state.lastLine])\n      : this.state.logs;\n\n    // 如果设置 rowHeight 就开启延迟渲染\n    const useVirtualRender = rowHeight;\n\n    if (useVirtualRender) {\n      lines = (\n        <VirtualList\n          height={height as number}\n          itemCount={logs.length}\n          itemSize={rowHeight}\n          renderItem={({index, style}) => (\n            <div\n              className={cx('Log-line')}\n              key={index}\n              style={{...style, whiteSpace: 'nowrap'}}\n            >\n              {showLineNumber && (\n                <span className={cx('Log-line-number')}>{index + 1} </span>\n              )}\n              {disableColor ? (\n                logs[index]\n              ) : (\n                <Ansi useClasses>{logs[index]}</Ansi>\n              )}\n            </div>\n          )}\n        />\n      );\n    } else {\n      lines = logs.map((line, index) => {\n        return this.renderLine(index, line, showLineNumber);\n      });\n    }\n\n    return (\n      <div className={cx('Log', className)}>\n        <div\n          ref={this.logRef}\n          className={cx('Log-body')}\n          style={{height: useVirtualRender ? 'auto' : height}}\n        >\n          {useVirtualRender ? lines : lines.length ? lines : loading}\n        </div>\n        <div className={cx('Log-operation')}>\n          {operation &&\n            operation?.length > 0 &&\n            (showOperation ? (\n              <>\n                {operation.includes('stop') && (\n                  <Button\n                    size=\"sm\"\n                    title=\"__('stop')\"\n                    disabled={!refresh}\n                    onClick={this.refresh}\n                  >\n                    <PauseIcon />\n                  </Button>\n                )}\n\n                {operation.includes('restart') && (\n                  <Button\n                    size=\"sm\"\n                    title={__('reload')}\n                    disabled={refresh}\n                    onClick={this.refresh}\n                  >\n                    <ReloadIcon />\n                  </Button>\n                )}\n\n                {operation.includes('showLineNumber') && (\n                  <Button\n                    size=\"sm\"\n                    title={\n                      showLineNumber\n                        ? __('Log.notShowLineNumber')\n                        : __('Log.showLineNumber')\n                    }\n                    onClick={this.changeShowLineNumber}\n                  >\n                    {showLineNumber ? <MinusIcon /> : <PlusIcon />}\n                  </Button>\n                )}\n\n                {operation.includes('clear') && (\n                  <Button size=\"sm\" title={__('clear')} onClick={this.clear}>\n                    <InputClearIcon />\n                  </Button>\n                )}\n\n                <Button\n                  size=\"sm\"\n                  title={__('Log.collapse')}\n                  onClick={this.changeShowOperation}\n                >\n                  <LeftArrowIcon />\n                </Button>\n              </>\n            ) : (\n              <div\n                title={__('Log.expand')}\n                className={cx('Log-operation-hidden')}\n                onClick={this.changeShowOperation}\n              >\n                <RightArrowIcon />\n              </div>\n            ))}\n        </div>\n      </div>\n    );\n  }\n}\n\n@Renderer({\n  type: 'log'\n})\nexport class LogRenderer extends Log {}\n"
    ]
}