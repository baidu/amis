{
    "version": 3,
    "file": "MatrixCheckboxes.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Form/MatrixCheckboxes.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "/**\n * @file filter\n * @author fex\n */\n\nimport React from 'react';\nimport {FormBaseControl, FormControlProps, FormItem} from './Item';\nimport {buildApi, isValidApi, isEffectiveApi} from '../../utils/api';\nimport {Checkbox, Spinner} from '../../components';\nimport {autobind, setVariable, createObject} from '../../utils/helper';\nimport {ApiObject, Action} from '../../types';\nimport {SchemaApi} from '../../Schema';\n\n/**\n * Matrix 选择控件。适合做权限勾选。\n * 文档：https://baidu.gitee.io/amis/docs/components/form/matrix\n */\nexport interface MatrixControlSchema extends FormBaseControl {\n  type: 'matrix-checkboxes';\n\n  /**\n   * 配置singleSelectMode时设置为false\n   */\n  multiple?: boolean;\n\n  /**\n   * 设置单选模式，multiple为false时有效\n   */\n  singleSelectMode?: boolean;\n\n  /**\n   * 可用来通过 API 拉取 options。\n   */\n  source?: SchemaApi;\n\n  columns?: Array<{\n    label: string;\n    [propName: string]: any;\n  }>;\n\n  rows?: Array<{\n    label: string;\n    [propName: string]: any;\n  }>;\n\n  /**\n   * 行标题说明\n   */\n  rowLabel?: string;\n}\n\nexport interface Column {\n  label: string;\n  [propName: string]: any;\n}\n\nexport interface Row {\n  label: string;\n  [propName: string]: any;\n}\n\nexport interface ValueItem extends Column, Row {\n  checked: boolean;\n}\n\nexport interface MatrixProps extends FormControlProps {\n  columns: Array<Column>;\n  rows: Array<Row>;\n  multiple: boolean;\n}\n\nexport interface MatrixState {\n  columns: Array<Column>;\n  rows: Array<Row>;\n  loading: boolean;\n  error?: string;\n  singleSelectMode?: 'cell' | 'row' | 'column';\n}\n\nexport default class MatrixCheckbox extends React.Component<\n  MatrixProps,\n  MatrixState\n> {\n  static defaultProps: Partial<MatrixProps> = {\n    columns: [],\n    rows: [],\n    multiple: true,\n    singleSelectMode: 'column' // multiple 为 false 时有效。\n  };\n\n  state: MatrixState;\n  mounted: boolean = false;\n\n  constructor(props: MatrixProps) {\n    super(props);\n\n    this.state = {\n      columns: props.columns || [],\n      rows: props.rows || [],\n      loading: false\n    };\n\n    this.toggleItem = this.toggleItem.bind(this);\n    this.reload = this.reload.bind(this);\n    this.initOptions = this.initOptions.bind(this);\n    this.mounted = true;\n  }\n\n  componentDidMount() {\n    const {formInited, addHook} = this.props;\n\n    formInited || !addHook ? this.reload() : addHook(this.initOptions, 'init');\n  }\n\n  componentDidUpdate(prevProps: MatrixProps) {\n    const props = this.props;\n\n    if (prevProps.columns !== props.columns || prevProps.rows !== props.rows) {\n      this.setState({\n        columns: props.columns || [],\n        rows: props.rows || []\n      });\n    } else if (\n      props.formInited &&\n      (props.source !== prevProps.source || prevProps.data !== props.data)\n    ) {\n      let prevApi = buildApi(\n        prevProps.source as string,\n        prevProps.data as object,\n        {\n          ignoreData: true\n        }\n      );\n      let nextApi = buildApi(props.source as string, props.data as object, {\n        ignoreData: true\n      });\n\n      if (prevApi.url !== nextApi.url && isValidApi(nextApi.url)) {\n        this.reload();\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n    const {removeHook} = this.props;\n    removeHook?.(this.initOptions, 'init');\n  }\n\n  doAction(action: Action, data: object, throwErrors: boolean) {\n    const {resetValue, onChange} = this.props;\n    const actionType = action?.actionType as string;\n\n    if (actionType === 'clear') {\n      onChange?.('');\n    } else if (actionType === 'reset') {\n      onChange?.(resetValue ?? '');\n    }\n  }\n\n  async initOptions(data: any) {\n    await this.reload();\n    const {formItem, name} = this.props;\n    if (!formItem) {\n      return;\n    }\n    if (formItem.value) {\n      setVariable(data, name!, formItem.value);\n    }\n  }\n\n  async reload() {\n    const {source, data, env, onChange, translate: __} = this.props;\n\n    if (!isEffectiveApi(source, data) || this.state.loading) {\n      return;\n    }\n\n    if (!env || !env.fetcher) {\n      throw new Error('fetcher is required');\n    }\n\n    // todo 优化这块\n    return await new Promise<void>((resolve, reject) => {\n      if (!this.mounted) {\n        return resolve();\n      }\n\n      this.setState(\n        {\n          loading: true\n        },\n        () => {\n          if (!this.mounted) {\n            return resolve();\n          }\n          env\n            .fetcher(source, data)\n            .then(ret => {\n              if (!ret.ok) {\n                throw new Error(ret.msg || __('fetchFailed'));\n              }\n              if (!this.mounted) {\n                return resolve();\n              }\n              this.setState(\n                {\n                  loading: false,\n                  rows: (ret.data as any).rows || [],\n                  columns: (ret.data as any).columns || []\n                },\n                () => {\n                  let replace = source && (source as ApiObject).replaceData;\n                  let value = (ret.data as any).value;\n                  if (value) {\n                    value = (source as ApiObject).replaceData\n                      ? value\n                      : mergeValue(value, this.state.columns, this.state.rows);\n                    onChange(value);\n                  }\n                  resolve();\n                }\n              );\n            })\n            .catch(reason =>\n              this.setState(\n                {\n                  error: reason,\n                  loading: false\n                },\n                () => resolve()\n              )\n            );\n        }\n      );\n    });\n  }\n\n  async toggleItem(checked: boolean, x: number, y: number) {\n    const {columns, rows} = this.state;\n    const {multiple, singleSelectMode, dispatchEvent, data} = this.props;\n\n    const value = this.props.value || buildDefaultValue(columns, rows);\n\n    if (multiple) {\n      value[x][y] = {\n        ...value[x][y],\n        checked\n      };\n    } else if (singleSelectMode === 'row') {\n      for (let x2 = 0, len = columns.length; x2 < len; x2++) {\n        value[x2][y] = {\n          ...value[x2][y],\n          checked: x === x2 ? checked : !checked\n        };\n      }\n    } else if (singleSelectMode === 'column') {\n      for (let y2 = 0, len = rows.length; y2 < len; y2++) {\n        value[x][y2] = {\n          ...value[x][y2],\n          checked: y === y2 ? checked : !checked\n        };\n      }\n    } else {\n      // 只剩下 cell 了\n      for (let y2 = 0, len = rows.length; y2 < len; y2++) {\n        for (let x2 = 0, len2 = columns.length; x2 < len2; x2++) {\n          value[x2][y2] = {\n            ...value[x2][y2],\n            checked: x === x2 && y === y2 ? checked : !checked\n          };\n        }\n      }\n    }\n\n    const rendererEvent = await dispatchEvent(\n      'change',\n      createObject(data, {\n        value: value.concat()\n      })\n    );\n    if (rendererEvent?.prevented) {\n      return;\n    }\n\n    this.props.onChange(value.concat());\n  }\n\n  renderInput() {\n    const {columns, rows} = this.state;\n    const {rowLabel, disabled, classnames: cx, multiple} = this.props;\n\n    const value = this.props.value || buildDefaultValue(columns, rows);\n\n    return (\n      <div className={cx('Table m-b-none')}>\n        <div className={cx('Table-content')}>\n          <table className={cx('Table-table')}>\n            <thead>\n              <tr>\n                <th>{rowLabel}</th>\n                {columns.map((column, x) => (\n                  <th key={x} className=\"text-center\">\n                    {column.label}\n                  </th>\n                ))}\n              </tr>\n            </thead>\n            <tbody>\n              {rows.map((row, y) => (\n                <tr key={y}>\n                  <td>\n                    {row.label}\n                    {row.description || row.desc ? (\n                      <span className=\"m-l-xs text-muted text-xs\">\n                        {row.description || row.desc}\n                      </span>\n                    ) : null}\n                  </td>\n                  {columns.map((column, x) => (\n                    <td key={x} className=\"text-center\">\n                      <Checkbox\n                        type={multiple ? 'checkbox' : 'radio'}\n                        disabled={disabled}\n                        checked={\n                          !!(value[x] && value[x][y] && value[x][y].checked)\n                        }\n                        onChange={(checked: boolean) =>\n                          this.toggleItem(checked, x, y)\n                        }\n                      />\n                    </td>\n                  ))}\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n    );\n  }\n\n  render() {\n    const {className, render, classnames: cx} = this.props;\n\n    const {error, loading} = this.state;\n\n    return (\n      <div key=\"input\" className={cx('MatrixControl', className || '')}>\n        {error ? (\n          <div className={cx('MatrixControl-error Alert Alert--danger')}>\n            {String(error)}\n          </div>\n        ) : (\n          this.renderInput()\n        )}\n\n        <Spinner size=\"lg\" overlay key=\"info\" show={loading} />\n      </div>\n    );\n  }\n}\n\nfunction buildDefaultValue(\n  columns: Array<Column>,\n  rows: Array<Row>\n): Array<Array<ValueItem>> {\n  if (!Array.isArray(columns)) {\n    columns = [];\n  }\n\n  if (!Array.isArray(rows)) {\n    rows = [];\n  }\n\n  return columns.map(column =>\n    rows.map(row => ({\n      ...row,\n      ...column,\n      checked: false\n    }))\n  );\n}\n\nfunction mergeValue(\n  value: Array<Array<ValueItem>>,\n  columns: Array<Column>,\n  rows: Array<Row>\n): Array<Array<ValueItem>> {\n  return value.map((column, x) =>\n    column.map((item, y) => ({\n      ...columns[x],\n      ...rows[y],\n      ...item\n    }))\n  );\n}\n\n@FormItem({\n  type: 'matrix-checkboxes',\n  strictMode: false,\n  sizeMutable: false\n})\nexport class MatrixRenderer extends MatrixCheckbox {}\n"
    ]
}