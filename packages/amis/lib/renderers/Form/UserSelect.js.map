{
    "version": 3,
    "file": "UserSelect.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Form/UserSelect.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport cx from 'classnames';\nimport {\n  OptionsControl,\n  OptionsControlProps,\n  Option,\n  FormOptionsControl\n} from './Options';\nimport UserSelect from '../../components/UserSelect';\nimport UserTabSelect from '../../components/UserTabSelect';\nimport {isEffectiveApi} from '../../utils/api';\nimport find from 'lodash/find';\nimport {createObject, autobind} from '../../utils/helper';\nimport {PlainObject} from '../../types';\n\n/**\n * UserSelect 移动端人员选择。\n */\nexport interface UserSelectControlSchema extends FormOptionsControl {\n  type: 'users-select';\n}\n\nexport interface UserSelectProps extends OptionsControlProps {\n  /**\n   * 部门可选\n   */\n  isDep?: boolean;\n  /**\n   * 人员可选\n   */\n  isRef?: boolean;\n  /**\n   *\n   */\n  showNav?: boolean;\n  /**\n   * 导航头标题\n   */\n  navTitle?: string;\n  /**\n   * 选项卡模式\n   */\n  tabMode?: boolean;\n  tabOptions?: Array<any>;\n  /**\n   * 搜索字段\n   */\n  searchTerm?: string;\n  /**\n   * 搜索携带的额外参数\n   */\n  searchParam?: PlainObject;\n}\n\nexport default class UserSelectControl extends React.Component<\n  UserSelectProps,\n  any\n> {\n  static defaultProps: Partial<UserSelectProps> = {\n    showNav: true\n  };\n  input?: HTMLInputElement;\n  unHook: Function;\n  lazyloadRemote: Function;\n\n  constructor(props: UserSelectProps) {\n    super(props);\n  }\n\n  componentWillUnmount() {\n    this.unHook && this.unHook();\n  }\n\n  @autobind\n  async onSearch(input: string, cancelExecutor: Function, param?: PlainObject) {\n    let {searchApi, setLoading, env} = this.props;\n    searchApi = param?.searchApi || searchApi;\n    let searchTerm = param?.searchTerm || this.props.searchTerm || 'term';\n    let searchObj = param?.searchParam || this.props.searchParam || {};\n\n    const ctx = {\n      [searchTerm]: input,\n      ...searchObj\n    };\n\n    if (!isEffectiveApi(searchApi, ctx)) {\n      return Promise.resolve([]);\n    }\n\n    setLoading(true);\n    try {\n      const ret = await env.fetcher(searchApi, ctx, {\n        cancelExecutor,\n        autoAppend: true\n      });\n      let options = (ret.data && (ret.data as any).options) || ret.data || [];\n\n      return options;\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  @autobind\n  async deferLoad(data?: Object, isRef?: boolean, param?: PlainObject) {\n    let {env, deferApi, setLoading, formInited, addHook} = this.props;\n\n    deferApi = param?.deferApi || deferApi;\n\n    if (!env || !env.fetcher) {\n      throw new Error('fetcher is required');\n    }\n\n    const ctx = createObject(data, {});\n\n    if (!isEffectiveApi(deferApi, ctx)) {\n      return Promise.resolve([]);\n    }\n\n    try {\n      const ret = await env.fetcher(deferApi, ctx);\n\n      let options = (ret.data && (ret.data as any).options) || ret.data || [];\n\n      if (isRef) {\n        options.forEach((option: Option) => {\n          option.isRef = true;\n        });\n      }\n      return options;\n    } finally {\n      setLoading(false);\n    }\n  }\n\n  @autobind\n  async changeValue(value: Option | Array<Option> | string | void) {\n    const {\n      joinValues,\n      extractValue,\n      delimiter,\n      multiple,\n      valueField,\n      onChange,\n      options,\n      setOptions,\n      data,\n      dispatchEvent\n    } = this.props;\n    let newValue: string | Option | Array<Option> | void = value;\n    let additonalOptions: Array<any> = [];\n    (Array.isArray(value) ? value : value ? [value] : []).forEach(\n      (option: any) => {\n        let resolved = find(\n          options,\n          (item: any) =>\n            item[valueField || 'value'] == option[valueField || 'value']\n        );\n        resolved || additonalOptions.push(option);\n      }\n    );\n\n    if (joinValues) {\n      if (multiple) {\n        newValue = Array.isArray(value)\n          ? (value\n              .map(item => item[valueField || 'value'])\n              .join(delimiter) as string)\n          : value\n          ? (value as Option)[valueField || 'value']\n          : '';\n      } else {\n        newValue = newValue ? (newValue as Option)[valueField || 'value'] : '';\n      }\n    } else if (extractValue) {\n      if (multiple) {\n        newValue = Array.isArray(value)\n          ? value.map(item => item[valueField || 'value'])\n          : value\n          ? [(value as Option)[valueField || 'value']]\n          : [];\n      } else {\n        newValue = newValue ? (newValue as Option)[valueField || 'value'] : '';\n      }\n    }\n\n    const rendererEvent = await dispatchEvent(\n      'change',\n      createObject(data, {\n        value: newValue,\n        options\n      })\n    );\n    if (rendererEvent?.prevented) {\n      return;\n    }\n\n    onChange(newValue);\n  }\n\n  render() {\n    let {\n      showNav,\n      navTitle,\n      searchable,\n      options,\n      className,\n      selectedOptions,\n      tabOptions,\n      multi,\n      multiple,\n      isDep,\n      isRef,\n      placeholder,\n      searchPlaceholder,\n      tabMode,\n      data\n    } = this.props;\n    tabOptions?.forEach((item: any) => {\n      item.deferLoad = this.deferLoad;\n      item.onChange = this.changeValue;\n      item.onSearch = this.onSearch;\n    });\n\n    return (\n      <div className={cx(`UserSelectControl`, className)}>\n        {tabMode ? (\n          <UserTabSelect\n            selection={selectedOptions}\n            tabOptions={tabOptions}\n            multiple={multiple}\n            onChange={this.changeValue}\n            onSearch={this.onSearch}\n            deferLoad={this.deferLoad}\n            data={data}\n          />\n        ) : (\n          <UserSelect\n            showNav={showNav}\n            navTitle={navTitle}\n            selection={selectedOptions}\n            options={options}\n            multi={multi}\n            multiple={multiple}\n            searchable={searchable}\n            placeholder={placeholder}\n            searchPlaceholder={searchPlaceholder}\n            deferLoad={this.deferLoad}\n            onChange={this.changeValue}\n            onSearch={this.onSearch}\n            isDep={isDep}\n            isRef={isRef}\n          />\n        )}\n      </div>\n    );\n  }\n}\n\n@OptionsControl({\n  type: 'users-select'\n})\nexport class UserSelectControlRenderer extends UserSelectControl {}\n"
    ]
}