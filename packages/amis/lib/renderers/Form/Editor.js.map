{
    "version": 3,
    "file": "Editor.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Form/Editor.tsx"
    ],
    "names": [],
    "mappings": ";;;;AAAA,6DAA0B;AAC1B,+BAAmE;AACnE,8FAA2D;AAE3D,gFAA6C;AAC7C,6CAA4C;AAC5C,uDAGiC;AACjC,uDAA2D;AAqH3D;IAA2C,8CAAiC;IAsB1E,uBAAY,KAAkB;QAA9B,YACE,kBAAM,KAAK,CAAC,SAKb;QAZD,WAAK,GAAG;YACN,OAAO,EAAE,KAAK;SACf,CAAC;QAEF,eAAS,GAAoB,EAAE,CAAC;QAChC,YAAM,GAAG,eAAK,CAAC,SAAS,EAAkB,CAAC;QAuE3C,gBAAU,GAAG,CAAC,CAAC;QAnEb,KAAI,CAAC,WAAW,GAAG,KAAI,CAAC,WAAW,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QAC/C,KAAI,CAAC,UAAU,GAAG,KAAI,CAAC,UAAU,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;QAC7C,KAAI,CAAC,mBAAmB,GAAG,KAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,KAAI,CAAC,CAAC;;IACjE,CAAC;IAED,4CAAoB,GAApB;QACE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,UAAA,EAAE,IAAI,OAAA,EAAE,EAAE,EAAJ,CAAI,CAAC,CAAC;IACrC,CAAC;IAED,gCAAQ,GAAR,UAAS,MAAsB,EAAE,IAAS;QACxC,IAAM,UAAU,GAAG,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,UAAoB,CAAC;QAC1C,IAAA,KAAyB,IAAI,CAAC,KAAK,EAAlC,QAAQ,cAAA,EAAE,UAAU,gBAAc,CAAC;QAE1C,IAAI,UAAU,KAAK,OAAO,EAAE;YAC1B,QAAQ,CAAC,EAAE,CAAC,CAAC;SACd;aAAM,IAAI,UAAU,KAAK,OAAO,EAAE;YACjC,QAAQ,CAAC,UAAU,aAAV,UAAU,cAAV,UAAU,GAAI,EAAE,CAAC,CAAC;SAC5B;aAAM,IAAI,UAAU,KAAK,OAAO,EAAE;YACjC,IAAI,CAAC,KAAK,EAAE,CAAC;SACd;IACH,CAAC;IAED,6BAAK,GAAL;;QACE,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC;QACpB,IAAI,CAAC,QAAQ,CAAC,EAAC,OAAO,EAAE,IAAI,EAAC,CAAC,CAAC;QAE/B,WAAW;QACX,IAAM,QAAQ,GAAoB,MAAA,IAAI,CAAC,MAAM,0CAAE,WAAW,EAAE,CAAC;QAC7D,MAAA,IAAI,CAAC,MAAM,0CAAE,WAAW,CAAC,QAAQ,CAAC,CAAC;IACrC,CAAC;IAGD,mCAAW,GAAX;QACE,IAAI,CAAC,QAAQ,CAAC;YACZ,OAAO,EAAE,IAAI;SACd,CAAC,CAAC;IACL,CAAC;IAGD,kCAAU,GAAV;QACE,IAAI,CAAC,QAAQ,CAAC;YACZ,OAAO,EAAE,KAAK;SACf,CAAC,CAAC;IACL,CAAC;IAED,2CAAmB,GAAnB,UAAoB,MAAW,EAAE,MAAW;QAA5C,iBAoBC;QAnBC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;QACrB,IAAI,CAAC,SAAS,CAAC,IAAI,CACjB,MAAM,CAAC,2BAA2B,CAAC;YACjC,KAAI,CAAC,mBAAmB,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC,CAAC,SAAS;YACnD,qBAAqB,CACnB,KAAI,CAAC,mBAAmB,CAAC,IAAI,CAAC,KAAI,EAAE,MAAM,EAAE,MAAM,CAAC,CACpD,CAAC,CAAC,UAAU;QACf,CAAC,CAAC,CAAC,OAAO,CACX,CAAC;QACF,IAAI,IAAI,CAAC,KAAK,CAAC,cAAc,EAAE;YAC7B,IAAI,cAAc,GAAG,IAAI,CAAC,KAAK,CAAC,cAAc,CAAC;YAC/C,IAAI,OAAO,cAAc,KAAK,QAAQ,EAAE;gBACtC,cAAc,GAAG,IAAI,QAAQ,CAAC,QAAQ,EAAE,QAAQ,CAAC,CAAC;aACnD;YACD,IAAM,OAAO,GAAG,cAAc,CAAC,MAAM,EAAE,MAAM,CAAC,CAAC;YAC/C,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE;gBACjC,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;aAC9B;SACF;IACH,CAAC;IAID,2CAAmB,GAAnB,UAAoB,MAAW,EAAE,MAAW;;QAC1C,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE;YACxB,OAAO;SACR;QAED,IAAM,UAAU,GAAG,MAAM,CAAC,SAAS,CAAC,MAAM,CAAC,MAAM,CAAC,YAAY,CAAC,UAAU,CAAC,CAAC;QAC3E,IAAM,SAAS,GAAG,CAAA,MAAA,MAAM,CAAC,QAAQ,EAAE,0CAAE,YAAY,EAAE,KAAI,CAAC,CAAC;QACzD,IAAM,MAAM,GAAG,MAAM,CAAC,mBAAmB,CAAC,SAAS,GAAG,CAAC,CAAC,GAAG,UAAU,CAAC;QAEtE,IAAI,IAAI,CAAC,UAAU,KAAK,MAAM,EAAE;YAC9B,IAAI,CAAC,UAAU,GAAG,MAAM,CAAC;YACzB,IAAI,CAAC,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,GAAG,UAAG,MAAM,OAAI,CAAC;YACjD,MAAM,CAAC,MAAM,EAAE,CAAC;SACjB;IACH,CAAC;IAED,8BAAM,GAAN;;QACQ,IAAA,KAYF,IAAI,CAAC,KAAK,EAXZ,SAAS,eAAA,EACI,EAAE,iBAAA,EACH,EAAE,gBAAA,EACd,KAAK,WAAA,EACL,QAAQ,cAAA,EACR,QAAQ,cAAA,EACR,OAAO,aAAA,EACP,WAAW,iBAAA,EACX,IAAI,UAAA,EACJ,IAAI,UAAA,EACJ,eAAe,qBACH,CAAC;QAEf,IAAI,QAAQ,GAAG,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC;QAEnC,IAAI,WAAW,GAAG,KAAK,CAAC;QAExB,IAAI,WAAW,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;YAClD,WAAW,GAAG,IAAI,CAAC,SAAS,CAAC,WAAW,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC;SACpD;QAED,IAAI,IAAA,4BAAc,EAAC,QAAQ,CAAC,EAAE;YAC5B,QAAQ,GAAG,IAAA,sCAAwB,EAAC,QAAQ,EAAE,IAAI,CAAC,CAAC;SACrD;QAED,OAAO,CACL,uCACE,GAAG,EAAE,IAAI,CAAC,MAAM,EAChB,SAAS,EAAE,EAAE,CACX,eAAe;oBAEb,YAAY,EAAE,IAAI,CAAC,KAAK,CAAC,OAAO;;gBAChC,GAAC,yBAAkB,IAAI,CAAE,IAAG,IAAI;qBAElC,SAAS,CACV;YAED,8BAAC,uBAAa,IACZ,WAAW,EAAE,EAAE,EACf,SAAS,EAAE,gBAAM,EACjB,eAAe,EAAE,eAAe,EAChC,KAAK,EAAE,WAAW,EAClB,QAAQ,EAAE,QAAQ,EAClB,QAAQ,EAAE,QAAQ,EAClB,OAAO,EAAE,IAAI,CAAC,WAAW,EACzB,MAAM,EAAE,IAAI,CAAC,UAAU,EACvB,QAAQ,EAAE,QAAQ,EAClB,WAAW,EAAE,WAAW,EACxB,cAAc,EAAE,IAAI,CAAC,mBAAmB,EACxC,OAAO,kDACF,OAAO,KACV,QAAQ,EAAE,QAAQ,MAEpB,CACE,CACP,CAAC;IACJ,CAAC;IAvKM,0BAAY,GAAyB;QAC1C,QAAQ,EAAE,YAAY;QACtB,WAAW,EAAE,IAAI;QACjB,eAAe,EAAE,IAAI;QACrB,OAAO,EAAE;YACP,eAAe,EAAE,IAAI;YACrB,mBAAmB,EAAE,IAAI;YACzB,oBAAoB,EAAE,KAAK;YAC3B,OAAO,EAAE,IAAI;YACb,OAAO,EAAE;gBACP,OAAO,EAAE,KAAK;aACf;SACF;KACF,CAAC;IA2CF;QADC,IAAA,8BAAiB,EAAmC,OAAO,CAAC;;;;oDAK5D;IAGD;QADC,IAAA,8BAAiB,EAAmC,MAAM,CAAC;;;;mDAK3D;IA0BD;QADC,iBAAQ;;;;4DAeR;IA6DH,oBAAC;CAAA,AAzKD,CAA2C,eAAK,CAAC,SAAS,GAyKzD;kBAzKoB,aAAa;AA2KrB,QAAA,kBAAkB,GAAG;IAChC,KAAK;IACL,GAAG;IACH,cAAc;IACd,KAAK;IACL,QAAQ;IACR,KAAK;IACL,YAAY;IACZ,QAAQ;IACR,IAAI;IACJ,YAAY;IACZ,MAAM;IACN,KAAK;IACL,MAAM;IACN,YAAY;IACZ,MAAM;IACN,MAAM;IACN,KAAK;IACL,UAAU;IACV,OAAO;IACP,aAAa;IACb,KAAK;IACL,WAAW;IACX,UAAU;IACV,YAAY;IACZ,KAAK;IACL,QAAQ;IACR,GAAG;IACH,OAAO;IACP,MAAM;IACN,IAAI;IACJ,MAAM;IACN,KAAK;IACL,OAAO;IACP,KAAK;IACL,OAAO;IACP,YAAY;IACZ,IAAI;IACJ,KAAK;IACL,MAAM;CACP,CAAC;AAEW,QAAA,cAAc,GACzB,0BAAkB,CAAC,GAAG,CAAC,UAAC,IAAY;IAKlC;QAAoC,sDAAa;QAAjD;;QASA,CAAC;QARQ,0BAAI,GAAG,IAAI,CAAC;QACZ,iCAAW,GAAG,UAAG,IAAI,CAAC,CAAC,CAAC,CAAC,WAAW,EAAE,SAAG,IAAI,CAAC,SAAS,CAC5D,CAAC,CACF,0BAAuB,CAAC;QAClB,kCAAY,mDACd,aAAa,CAAC,YAAY,KAC7B,QAAQ,EAAE,IAAI,IACd;QARE,qBAAqB;YAJ1B,IAAA,eAAQ,EAAC;gBACR,IAAI,EAAE,UAAG,IAAI,YAAS;gBACtB,WAAW,EAAE,KAAK;aACnB,CAAC;WACI,qBAAqB,CAS1B;QAAD,4BAAC;KAAA,AATD,CAAoC,aAAa,GAShD;IAED,OAAO,qBAAqB,CAAC;AAC/B,CAAC,CAAC,CAAC;AAML;IAA8C,gEAAa;IAA3D;;IAKA,CAAC;IAJQ,4CAAY,mDACd,aAAa,CAAC,YAAY,KAC7B,QAAQ,EAAE,YAAY,IACtB;IAJE,+BAA+B;QAJpC,IAAA,eAAQ,EAAC;YACR,IAAI,EAAE,WAAW;YACjB,WAAW,EAAE,KAAK;SACnB,CAAC;OACI,+BAA+B,CAKpC;IAAD,sCAAC;CAAA,AALD,CAA8C,aAAa,GAK1D;AAMD;IAA8C,gEAAa;IAA3D;;IAKA,CAAC;IAJQ,4CAAY,mDACd,aAAa,CAAC,YAAY,KAC7B,QAAQ,EAAE,YAAY,IACtB;IAJE,+BAA+B;QAJpC,IAAA,eAAQ,EAAC;YACR,IAAI,EAAE,WAAW;YACjB,WAAW,EAAE,KAAK;SACnB,CAAC;OACI,+BAA+B,CAKpC;IAAD,sCAAC;CAAA,AALD,CAA8C,aAAa,GAK1D;AAMD;IAA2C,sDAAa;IAAxD;;IAKA,CAAC;IAJQ,kCAAY,mDACd,aAAa,CAAC,YAAY,KAC7B,QAAQ,EAAE,YAAY,IACtB;IAJS,qBAAqB;QAJjC,IAAA,eAAQ,EAAC;YACR,IAAI,EAAE,QAAQ;YACd,WAAW,EAAE,KAAK;SACnB,CAAC;OACW,qBAAqB,CAKjC;IAAD,4BAAC;CAAA,AALD,CAA2C,aAAa,GAKvD;AALY,sDAAqB",
    "sourcesContent": [
        "import React from 'react';\nimport {FormItem, FormControlProps, FormBaseControl} from './Item';\nimport LazyComponent from '../../components/LazyComponent';\nimport debouce from 'lodash/debounce';\nimport Editor from '../../components/Editor';\nimport {autobind} from '../../utils/helper';\nimport {\n  isPureVariable,\n  resolveVariableAndFilter\n} from '../../utils/tpl-builtin';\nimport {bindRendererEvent} from '../../actions/Decorators';\n\nimport type {Position} from 'monaco-editor';\nimport type {ListenerAction} from '../../actions/Action';\n\n/**\n * Editor 代码编辑器\n * 文档：https://baidu.gitee.io/amis/docs/components/form/editor\n */\nexport interface EditorControlSchema extends Omit<FormBaseControl, 'size'> {\n  type:\n    | 'editor'\n    | 'bat-editor'\n    | 'c-editor'\n    | 'coffeescript-editor'\n    | 'cpp-editor'\n    | 'csharp-editor'\n    | 'css-editor'\n    | 'dockerfile-editor'\n    | 'fsharp-editor'\n    | 'go-editor'\n    | 'handlebars-editor'\n    | 'html-editor'\n    | 'ini-editor'\n    | 'java-editor'\n    | 'javascript-editor'\n    | 'json-editor'\n    | 'less-editor'\n    | 'lua-editor'\n    | 'markdown-editor'\n    | 'msdax-editor'\n    | 'objective-c-editor'\n    | 'php-editor'\n    | 'plaintext-editor'\n    | 'postiats-editor'\n    | 'powershell-editor'\n    | 'pug-editor'\n    | 'python-editor'\n    | 'r-editor'\n    | 'razor-editor'\n    | 'ruby-editor'\n    | 'sb-editor'\n    | 'scss-editor'\n    | 'sol-editor'\n    | 'sql-editor'\n    | 'swift-editor'\n    | 'typescript-editor'\n    | 'vb-editor'\n    | 'xml-editor'\n    | 'yaml-editor';\n\n  /**\n   * 语言类型\n   */\n  language?:\n    | 'bat'\n    | 'c'\n    | 'coffeescript'\n    | 'cpp'\n    | 'csharp'\n    | 'css'\n    | 'dockerfile'\n    | 'fsharp'\n    | 'go'\n    | 'handlebars'\n    | 'html'\n    | 'ini'\n    | 'java'\n    | 'javascript'\n    | 'json'\n    | 'less'\n    | 'lua'\n    | 'markdown'\n    | 'msdax'\n    | 'objective-c'\n    | 'php'\n    | 'plaintext'\n    | 'postiats'\n    | 'powershell'\n    | 'pug'\n    | 'python'\n    | 'r'\n    | 'razor'\n    | 'ruby'\n    | 'sb'\n    | 'scss'\n    | 'shell'\n    | 'sol'\n    | 'sql'\n    | 'swift'\n    | 'typescript'\n    | 'vb'\n    | 'xml'\n    | 'yaml';\n\n  /**\n   * 编辑器大小\n   */\n  size?: 'sm' | 'md' | 'lg' | 'xl' | 'xxl';\n\n  /**\n   * 是否展示全屏模式开关\n   */\n  allowFullscreen?: boolean;\n\n  /**\n   * 获取编辑器底层实例\n   */\n  editorDidMount?: string;\n}\n\nexport type EditorRendererEvent = 'blur' | 'focus';\n\nexport interface EditorProps extends FormControlProps {\n  options?: object;\n}\n\nexport default class EditorControl extends React.Component<EditorProps, any> {\n  static defaultProps: Partial<EditorProps> = {\n    language: 'javascript',\n    editorTheme: 'vs',\n    allowFullscreen: true,\n    options: {\n      automaticLayout: true,\n      selectOnLineNumbers: true,\n      scrollBeyondLastLine: false,\n      folding: true,\n      minimap: {\n        enabled: false\n      }\n    }\n  };\n\n  state = {\n    focused: false\n  };\n  editor: any;\n  toDispose: Array<Function> = [];\n  divRef = React.createRef<HTMLDivElement>();\n  constructor(props: EditorProps) {\n    super(props);\n\n    this.handleFocus = this.handleFocus.bind(this);\n    this.handleBlur = this.handleBlur.bind(this);\n    this.handleEditorMounted = this.handleEditorMounted.bind(this);\n  }\n\n  componentWillUnmount() {\n    this.toDispose.forEach(fn => fn());\n  }\n\n  doAction(action: ListenerAction, args: any) {\n    const actionType = action?.actionType as string;\n    const {onChange, resetValue} = this.props;\n\n    if (actionType === 'clear') {\n      onChange('');\n    } else if (actionType === 'reset') {\n      onChange(resetValue ?? '');\n    } else if (actionType === 'focus') {\n      this.focus();\n    }\n  }\n\n  focus() {\n    this.editor.focus();\n    this.setState({focused: true});\n\n    // 最近一次光标位置\n    const position: Position | null = this.editor?.getPosition();\n    this.editor?.setPosition(position);\n  }\n\n  @bindRendererEvent<EditorProps, EditorRendererEvent>('focus')\n  handleFocus() {\n    this.setState({\n      focused: true\n    });\n  }\n\n  @bindRendererEvent<EditorProps, EditorRendererEvent>('blur')\n  handleBlur() {\n    this.setState({\n      focused: false\n    });\n  }\n\n  handleEditorMounted(editor: any, monaco: any) {\n    this.editor = editor;\n    this.toDispose.push(\n      editor.onDidChangeModelDecorations(() => {\n        this.updateContainerSize(editor, monaco); // typing\n        requestAnimationFrame(\n          this.updateContainerSize.bind(this, editor, monaco)\n        ); // folding\n      }).dispose\n    );\n    if (this.props.editorDidMount) {\n      let editorDidMount = this.props.editorDidMount;\n      if (typeof editorDidMount === 'string') {\n        editorDidMount = new Function('editor', 'monaco');\n      }\n      const dispose = editorDidMount(editor, monaco);\n      if (typeof dispose === 'function') {\n        this.toDispose.push(dispose);\n      }\n    }\n  }\n\n  prevHeight = 0;\n  @autobind\n  updateContainerSize(editor: any, monaco: any) {\n    if (!this.divRef.current) {\n      return;\n    }\n\n    const lineHeight = editor.getOption(monaco.editor.EditorOption.lineHeight);\n    const lineCount = editor.getModel()?.getLineCount() || 1;\n    const height = editor.getTopForLineNumber(lineCount + 1) + lineHeight;\n\n    if (this.prevHeight !== height) {\n      this.prevHeight = height;\n      this.divRef.current.style.height = `${height}px`;\n      editor.layout();\n    }\n  }\n\n  render() {\n    const {\n      className,\n      classPrefix: ns,\n      classnames: cx,\n      value,\n      onChange,\n      disabled,\n      options,\n      editorTheme,\n      size,\n      data,\n      allowFullscreen\n    } = this.props;\n\n    let language = this.props.language;\n\n    let finnalValue = value;\n\n    if (finnalValue && typeof finnalValue !== 'string') {\n      finnalValue = JSON.stringify(finnalValue, null, 2);\n    }\n\n    if (isPureVariable(language)) {\n      language = resolveVariableAndFilter(language, data);\n    }\n\n    return (\n      <div\n        ref={this.divRef}\n        className={cx(\n          `EditorControl`,\n          {\n            'is-focused': this.state.focused,\n            [`EditorControl--${size}`]: size\n          },\n          className\n        )}\n      >\n        <LazyComponent\n          classPrefix={ns}\n          component={Editor}\n          allowFullscreen={allowFullscreen}\n          value={finnalValue}\n          onChange={onChange}\n          disabled={disabled}\n          onFocus={this.handleFocus}\n          onBlur={this.handleBlur}\n          language={language}\n          editorTheme={editorTheme}\n          editorDidMount={this.handleEditorMounted}\n          options={{\n            ...options,\n            readOnly: disabled\n          }}\n        />\n      </div>\n    );\n  }\n}\n\nexport const availableLanguages = [\n  'bat',\n  'c',\n  'coffeescript',\n  'cpp',\n  'csharp',\n  'css',\n  'dockerfile',\n  'fsharp',\n  'go',\n  'handlebars',\n  'html',\n  'ini',\n  'java',\n  'javascript',\n  'json',\n  'less',\n  'lua',\n  'markdown',\n  'msdax',\n  'objective-c',\n  'php',\n  'plaintext',\n  'postiats',\n  'powershell',\n  'pug',\n  'python',\n  'r',\n  'razor',\n  'ruby',\n  'sb',\n  'scss',\n  'sol',\n  'shell',\n  'sql',\n  'swift',\n  'typescript',\n  'vb',\n  'xml',\n  'yaml'\n];\n\nexport const EditorControls: Array<typeof EditorControl> =\n  availableLanguages.map((lang: string) => {\n    @FormItem({\n      type: `${lang}-editor`,\n      sizeMutable: false\n    })\n    class EditorControlRenderer extends EditorControl {\n      static lang = lang;\n      static displayName = `${lang[0].toUpperCase()}${lang.substring(\n        1\n      )}EditorControlRenderer`;\n      static defaultProps = {\n        ...EditorControl.defaultProps,\n        language: lang\n      };\n    }\n\n    return EditorControlRenderer;\n  });\n\n@FormItem({\n  type: 'js-editor',\n  sizeMutable: false\n})\nclass JavascriptEditorControlRenderer extends EditorControl {\n  static defaultProps = {\n    ...EditorControl.defaultProps,\n    language: 'javascript'\n  };\n}\n\n@FormItem({\n  type: 'ts-editor',\n  sizeMutable: false\n})\nclass TypescriptEditorControlRenderer extends EditorControl {\n  static defaultProps = {\n    ...EditorControl.defaultProps,\n    language: 'typescript'\n  };\n}\n\n@FormItem({\n  type: `editor`,\n  sizeMutable: false\n})\nexport class EditorControlRenderer extends EditorControl {\n  static defaultProps = {\n    ...EditorControl.defaultProps,\n    language: 'javascript'\n  };\n}\n"
    ]
}