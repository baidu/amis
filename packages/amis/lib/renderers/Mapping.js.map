{
    "version": 3,
    "file": "Mapping.js",
    "sourceRoot": "",
    "sources": [
        "/src/renderers/Mapping.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import React from 'react';\nimport {Renderer, RendererEnv, RendererProps} from '../factory';\nimport {ServiceStore, IServiceStore} from '../store/service';\nimport {Api, SchemaNode, PlainObject, Payload} from '../types';\nimport {filter} from '../utils/tpl';\nimport cx from 'classnames';\nimport {\n  BaseSchema,\n  SchemaApi,\n  SchemaTokenizeableString,\n  SchemaTpl\n} from '../Schema';\nimport {withStore} from '../components/WithStore';\nimport {flow, Instance, types} from 'mobx-state-tree';\nimport {getPropValue, getVariable, guid, isObject} from '../utils/helper';\nimport {StoreNode} from '../store/node';\nimport isPlainObject from 'lodash/isPlainObject';\nimport {isPureVariable, resolveVariableAndFilter} from '../utils/tpl-builtin';\nimport {\n  buildApi,\n  isApiOutdated,\n  isEffectiveApi,\n  normalizeApi,\n  normalizeApiResponseData\n} from '../utils/api';\n\n/**\n * Mapping 映射展示控件。\n * 文档：https://baidu.gitee.io/amis/docs/components/mapping\n */\nexport interface MappingSchema extends BaseSchema {\n  /**\n   * 指定为映射展示控件\n   */\n  type: 'map' | 'mapping';\n\n  /**\n   * 关联字段名。\n   */\n  name?: string;\n\n  /**\n   * 配置映射规则，值可以使用模板语法。当 key 为 * 时表示 else，也就是说值没有映射到任何规则时用 * 对应的值展示。\n   */\n  map?: {\n    [propName: string]: SchemaTpl;\n  };\n\n  /**\n   * 如果想远程拉取字典，请配置 source 为接口。\n   */\n  source?: SchemaApi | SchemaTokenizeableString;\n\n  /**\n   * 占位符\n   */\n  placeholder?: string;\n}\n\nexport const Store = StoreNode.named('MappingStore')\n  .props({\n    fetching: false,\n    errorMsg: '',\n    map: types.frozen<{\n      [propName: string]: any;\n    }>({})\n  })\n  .actions(self => {\n    const load: (env: RendererEnv, api: Api, data: any) => Promise<any> = flow(\n      function* (env, api, data) {\n        try {\n          self.fetching = true;\n          const ret: Payload = yield env.fetcher(api, data);\n\n          if (ret.ok) {\n            const data = normalizeApiResponseData(ret.data);\n            (self as any).setMap(data);\n          } else {\n            throw new Error(ret.msg || 'fetch error');\n          }\n        } catch (e) {\n          self.errorMsg = e.message;\n        } finally {\n          self.fetching = false;\n        }\n      }\n    );\n\n    return {\n      load,\n      setMap(options: any) {\n        if (isObject(options)) {\n          self.map = {\n            ...options\n          };\n        }\n      }\n    };\n  });\n\nexport type IStore = Instance<typeof Store>;\n\nexport interface MappingProps\n  extends Omit<RendererProps, 'store'>,\n    Omit<MappingSchema, 'type' | 'className'> {\n  store: IStore;\n}\n\nexport const MappingField = withStore(props =>\n  Store.create(\n    {\n      id: guid(),\n      storeType: Store.name\n    },\n    props.env\n  )\n)(\n  class extends React.Component<MappingProps, object> {\n    static defaultProps: Partial<MappingProps> = {\n      placeholder: '-',\n      map: {\n        '*': '通配值'\n      }\n    };\n\n    constructor(props: MappingProps) {\n      super(props);\n\n      props.store.syncProps(props, undefined, ['map']);\n    }\n\n    componentDidMount() {\n      const {store, source, data} = this.props;\n\n      this.reload();\n    }\n\n    componentDidUpdate(prevProps: MappingProps) {\n      const props = this.props;\n      const {store, source, data} = this.props;\n\n      store.syncProps(props, prevProps, ['map']);\n\n      if (isPureVariable(source)) {\n        const prev = resolveVariableAndFilter(\n          prevProps.source as string,\n          prevProps.data,\n          '| raw'\n        );\n        const curr = resolveVariableAndFilter(source as string, data, '| raw');\n\n        if (prev !== curr) {\n          store.setMap(curr);\n        }\n      } else if (\n        isApiOutdated(\n          prevProps.source,\n          props.source,\n          prevProps.data,\n          props.data\n        )\n      ) {\n        this.reload();\n      }\n    }\n\n    reload() {\n      const {source, data, env} = this.props;\n      const store = this.props.store;\n      if (isPureVariable(source)) {\n        store.setMap(resolveVariableAndFilter(source, data, '| raw'));\n      } else if (isEffectiveApi(source, data)) {\n        const api = normalizeApi(source, 'get');\n        api.cache = api.cache ?? 30 * 1000;\n        store.load(env, api, data);\n      }\n    }\n\n    renderSingleValue(key: any, reactKey?: number) {\n      const {\n        className,\n        placeholder,\n        render,\n        classnames: cx,\n        name,\n        data,\n        store\n      } = this.props;\n      let viewValue: React.ReactNode = (\n        <span className=\"text-muted\">{placeholder}</span>\n      );\n      const map = store.map;\n      let value: any = undefined;\n      // trim 一下，干掉一些空白字符。\n      key = typeof key === 'string' ? key.trim() : key;\n      if (\n        typeof key !== 'undefined' &&\n        map &&\n        (value =\n          map[key] ??\n          (key === true && map['1']\n            ? map['1']\n            : key === false && map['0']\n            ? map['0']\n            : map['*'])) !== undefined\n      ) {\n        viewValue = render('tpl', value);\n      }\n\n      return (\n        <span key={`map-${reactKey}`} className={cx('MappingField', className)}>\n          {viewValue}\n        </span>\n      );\n    }\n\n    render() {\n      const mapKey = getPropValue(this.props);\n      if (Array.isArray(mapKey)) {\n        return (\n          <span>\n            {mapKey.map((singleKey: string, index: number) =>\n              this.renderSingleValue(singleKey, index)\n            )}\n          </span>\n        );\n      } else {\n        return this.renderSingleValue(mapKey, 0);\n      }\n    }\n  }\n);\n\n@Renderer({\n  test: /(^|\\/)(?:map|mapping)$/,\n  name: 'mapping'\n})\nexport class MappingFieldRenderer extends React.Component<RendererProps> {\n  render() {\n    return <MappingField {...this.props} />;\n  }\n}\n"
    ]
}