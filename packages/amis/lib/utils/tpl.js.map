{
    "version": 3,
    "file": "tpl.js",
    "sourceRoot": "",
    "sources": [
        "/src/utils/tpl.ts"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "import {createObject} from './helper';\nimport {register as registerBulitin, getFilters} from './tpl-builtin';\nimport {register as registerLodash} from './tpl-lodash';\nimport {parse, evaluate} from 'amis-formula';\n\nexport interface Enginer {\n  test: (tpl: string) => boolean;\n  removeEscapeToken?: (tpl: string) => string;\n  compile: (tpl: string, data: object, ...rest: Array<any>) => string;\n}\n\nconst enginers: {\n  [propName: string]: Enginer;\n} = {};\n\nexport function registerTplEnginer(name: string, enginer: Enginer) {\n  enginers[name] = enginer;\n}\n\nexport function filter(\n  tpl?: any,\n  data: object = {},\n  ...rest: Array<any>\n): string {\n  if (!tpl || typeof tpl !== 'string') {\n    return '';\n  }\n\n  let keys = Object.keys(enginers);\n  for (let i = 0, len = keys.length; i < len; i++) {\n    let enginer = enginers[keys[i]];\n    if (enginer.test(tpl)) {\n      return enginer.compile(tpl, data, ...rest);\n    } else if (enginer.removeEscapeToken) {\n      tpl = enginer.removeEscapeToken(tpl);\n    }\n  }\n\n  return tpl;\n}\n\n// 缓存一下提升性能\nconst EVAL_CACHE: {[key: string]: Function} = {};\n\nlet customEvalExpressionFn: (expression: string, data?: any) => boolean;\nexport function setCustomEvalExpression(\n  fn: (expression: string, data?: any) => boolean\n) {\n  customEvalExpressionFn = fn;\n}\n\n// 几乎所有的 visibleOn requiredOn 都是通过这个方法判断出来结果，很粗暴也存在风险，建议自己实现。\n// 如果想自己实现，请通过 setCustomEvalExpression 来替换。\nexport function evalExpression(expression: string, data?: object): boolean {\n  if (typeof customEvalExpressionFn === 'function') {\n    return customEvalExpressionFn(expression, data);\n  }\n\n  if (!expression || typeof expression !== 'string') {\n    return false;\n  }\n\n  /* jshint evil:true */\n  try {\n    if (\n      typeof expression === 'string' &&\n      expression.substring(0, 2) === '${' &&\n      expression[expression.length - 1] === '}'\n    ) {\n      // 启用新版本的公式表达式\n      return evalFormula(expression, data);\n    }\n\n    let debug = false;\n    const idx = expression.indexOf('debugger');\n    if (~idx) {\n      debug = true;\n      expression = expression.replace(/debugger;?/, '');\n    }\n\n    let fn;\n    if (expression in EVAL_CACHE) {\n      fn = EVAL_CACHE[expression];\n    } else {\n      fn = new Function(\n        'data',\n        'utils',\n        `with(data) {${debug ? 'debugger;' : ''}return !!(${expression});}`\n      );\n      EVAL_CACHE[expression] = fn;\n    }\n\n    data = data || {};\n    return fn.call(data, data, getFilters());\n  } catch (e) {\n    console.warn(expression, e);\n    return false;\n  }\n}\n\nconst AST_CACHE: {[key: string]: any} = {};\nfunction evalFormula(expression: string, data: any) {\n  const ast =\n    AST_CACHE[expression] ||\n    parse(expression, {\n      evalMode: false\n    });\n  AST_CACHE[expression] = ast;\n\n  return evaluate(ast, data, {\n    defaultFilter: 'raw'\n  });\n}\n\nlet customEvalJsFn: (expression: string, data?: any) => any;\nexport function setCustomEvalJs(fn: (expression: string, data?: any) => any) {\n  customEvalJsFn = fn;\n}\n\n// 这个主要用在 formula 里面，用来动态的改变某个值。也很粗暴，建议自己实现。\n// 如果想自己实现，请通过 setCustomEvalJs 来替换。\nexport function evalJS(js: string, data: object): any {\n  if (typeof customEvalJsFn === 'function') {\n    return customEvalJsFn(js, data);\n  }\n\n  /* jshint evil:true */\n  try {\n    if (\n      typeof js === 'string' &&\n      js.substring(0, 2) === '${' &&\n      js[js.length - 1] === '}'\n    ) {\n      // 启用新版本的公式表达式\n      return evalFormula(js, data);\n    }\n\n    const fn = new Function(\n      'data',\n      'utils',\n      `with(data) {${/^\\s*return\\b/.test(js) ? '' : 'return '}${js};}`\n    );\n    data = data || {};\n    return fn.call(data, data, getFilters());\n  } catch (e) {\n    console.warn(js, e);\n    return null;\n  }\n}\n\n[registerBulitin, registerLodash].forEach(fn => {\n  const info = fn();\n\n  registerTplEnginer(info.name, {\n    test: info.test,\n    compile: info.compile,\n    removeEscapeToken: info.removeEscapeToken\n  });\n});\n"
    ]
}