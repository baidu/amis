{
    "version": 3,
    "file": "PickerColumn.js",
    "sourceRoot": "",
    "sources": [
        "/src/components/PickerColumn.tsx"
    ],
    "names": [],
    "mappings": "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",
    "sourcesContent": [
        "/**\n * @file Picker\n * @description 移动端列滚动选择器\n */\nimport React, {\n  useEffect,\n  useMemo,\n  useRef,\n  useImperativeHandle,\n  useCallback,\n  forwardRef\n} from 'react';\nimport isObject from 'lodash/isObject';\nimport cloneDeep from 'lodash/cloneDeep';\nimport {uncontrollable} from 'uncontrollable';\n\nimport {useSetState, useUpdateEffect} from '../hooks';\nimport {range} from '../utils/helper';\nimport {themeable, ThemeProps} from '../theme';\nimport useTouch from '../hooks/use-touch';\n\nexport interface PickerColumnItem {\n  labelField?: string;\n  valueField?: string;\n  readonly?: boolean;\n  value?: PickerOption;\n  swipeDuration?: number;\n  visibleItemCount?: number;\n  itemHeight?: number;\n  options?: PickerOption[];\n  optionRender?: (option: string | object | PickerOption) => React.ReactNode;\n  onChange?: (\n    value?: PickerOption | string,\n    index?: number,\n    confirm?: boolean\n  ) => void;\n}\n\nexport interface PickerColumnProps extends PickerColumnItem, ThemeProps {}\n\nexport type PickerOption = string | number | PickerObjectOption;\n\nexport type PickerObjectOption = {\n  value?: string | number;\n  text?: string | number;\n  disabled?: boolean;\n} & Record<string, {}>;\n\nconst DEFAULT_DURATION = 200;\nconst MOMENTUM_LIMIT_TIME = 300;\nconst MOMENTUM_LIMIT_DISTANCE = 15;\n\nfunction getElementTranslateY(element: HTMLElement | null) {\n  if (!element) {\n    return 0;\n  }\n  const style = window.getComputedStyle(element);\n  const transform = style.transform || style.webkitTransform;\n  // 格式如：matrix( scaleX(), skewY(), skewX(), scaleY(), translateX(), translateY() );\n  const translateY = transform.slice(7, transform.length - 1).split(', ')[5];\n\n  return Number(translateY);\n}\n\nfunction isOptionDisabled(option: PickerOption) {\n  return isObject(option) && option.disabled;\n}\n\nconst PickerColumn = forwardRef<{}, PickerColumnProps>((props, ref) => {\n  const {\n    visibleItemCount = 5,\n    itemHeight = 48,\n    value,\n    valueField = 'value',\n    swipeDuration = 1000,\n    labelField = 'text',\n    options = [],\n    classnames: cx\n  } = props;\n\n  const root = useRef(null);\n  const menuItemRef = useRef(null);\n  const wrapper = useRef(null);\n\n  const moving = useRef(false);\n  const startOffset = useRef(0);\n  const transitionEndTrigger = useRef(null);\n  const touchStartTime = useRef(0);\n  const momentumOffset = useRef(0);\n\n  const touch = useTouch();\n  const count = options.length;\n\n  const getOptionText = (option: [] | PickerOption) => {\n    if (isObject(option) && labelField in option) {\n      //@ts-ignore\n      return option[labelField];\n    }\n    return option;\n  };\n\n  const getOptionValue = (option: [] | PickerOption) => {\n    if (isObject(option) && valueField in option) {\n      //@ts-ignore\n      return option[valueField];\n    }\n    return option;\n  };\n\n  const defaultIndex = options.findIndex(item => getOptionValue(item) === value);\n\n  const baseOffset = useMemo(() => {\n    // 默认转入第一个选项的位置\n    return (itemHeight * (+visibleItemCount - 1)) / 2;\n  }, [itemHeight, visibleItemCount]);\n\n  const adjustIndex = (index: number) => {\n    index = range(index, 0, count);\n    if (!options) {\n      return;\n    }\n\n    for (let i = index; i < count; i += 1) {\n      if (!isOptionDisabled(options[i])) return i;\n    }\n    for (let i = index - 1; i >= 0; i -= 1) {\n      if (!isOptionDisabled(options[i])) return i;\n    }\n\n    return null;\n  };\n\n  const [state, updateState] = useSetState({\n    index: adjustIndex(defaultIndex) || 0,\n    offset: 0,\n    duration: 0,\n    options: cloneDeep(options)\n  });\n\n  /**\n   *\n   * @param index 索引\n   * @param emitChange 是否派发变动消息\n   * @param confirm 是否为确认类型，为真时触发value改变\n   */\n  const setIndex = (index: number, emitChange?: boolean, confirm?: boolean) => {\n    index = adjustIndex(index) || 0;\n\n    const offset = -index * itemHeight;\n    const trigger = () => {\n      updateState({index});\n\n      if (emitChange && props.onChange) {\n        requestAnimationFrame(\n          () => {\n            props.onChange?.(getOptionValue(options[index]), index, confirm);\n          }\n        );\n      }\n    };\n\n    // trigger the change event after transitionend when moving\n    if (moving.current && offset !== state.offset) {\n      //@ts-ignore\n      transitionEndTrigger.current = trigger;\n    } else {\n      trigger();\n    }\n    updateState({offset});\n  };\n\n  const setOptions = (options: Array<PickerOption>) => {\n    if (JSON.stringify(options) !== JSON.stringify(state.options)) {\n      updateState({options});\n      const index = options.findIndex(item => getOptionValue(item) === value) || 0;\n      setIndex(index, true, true);\n    }\n  };\n\n  const onClickItem = (index: number) => {\n    if (moving.current || props.readonly) {\n      return;\n    }\n    transitionEndTrigger.current = null;\n    updateState({duration: DEFAULT_DURATION});\n    setIndex(index, true, true);\n  };\n\n  const getIndexByOffset = (offset: number) =>\n    range(Math.round(-offset / itemHeight), 0, count - 1);\n\n  const momentum = (distance: number, duration: number) => {\n    const speed = Math.abs(distance / duration);\n\n    distance = state.offset + (speed / 0.003) * (distance < 0 ? -1 : 1);\n\n    const index = getIndexByOffset(distance);\n    updateState({duration: +swipeDuration});\n    setIndex(index, true);\n  };\n\n  const stopMomentum = () => {\n    moving.current = false;\n    updateState({duration: 0});\n\n    if (transitionEndTrigger.current) {\n      //@ts-ignore\n      transitionEndTrigger.current();\n      transitionEndTrigger.current = null;\n    }\n  };\n\n  const onTouchStart = (event: any) => {\n    if (props.readonly) {\n      return;\n    }\n\n    touch.start(event);\n    let {offset} = state;\n\n    if (moving.current) {\n      const translateY = getElementTranslateY(wrapper.current);\n      offset = Math.min(0, translateY - baseOffset);\n      startOffset.current = offset;\n    } else {\n      startOffset.current = offset;\n    }\n\n    updateState({duration: 0, offset});\n    touchStartTime.current = Date.now();\n    momentumOffset.current = startOffset.current;\n    transitionEndTrigger.current = null;\n  };\n\n  const onTouchMove = (event: TouchEvent | React.TouchEvent) => {\n    if (props.readonly) {\n      return;\n    }\n\n    touch.move(event as TouchEvent);\n\n    if (touch.isVertical()) {\n      moving.current = true;\n    }\n\n    const offset = range(\n      startOffset.current + touch.deltaY,\n      -(count * itemHeight),\n      itemHeight\n    );\n\n    updateState({\n      offset\n    });\n\n    const now = Date.now();\n    if (now - touchStartTime.current > MOMENTUM_LIMIT_TIME) {\n      touchStartTime.current = now;\n      momentumOffset.current = offset;\n    }\n  };\n\n  const onTouchEnd = () => {\n    if (props.readonly) {\n      return;\n    }\n    const distance = state.offset - momentumOffset.current;\n    const duration = Date.now() - touchStartTime.current;\n\n    const allowMomentum =\n      duration < MOMENTUM_LIMIT_TIME &&\n      Math.abs(distance) > MOMENTUM_LIMIT_DISTANCE;\n\n    if (allowMomentum) {\n      momentum(distance, duration);\n      return;\n    }\n\n    const index = getIndexByOffset(state.offset);\n    updateState({duration: DEFAULT_DURATION});\n    setIndex(index, true);\n\n    // compatible with desktop scenario\n    // use setTimeout to skip the click event triggered after touchstart\n    setTimeout(() => {\n      moving.current = false;\n    }, 0);\n  };\n\n  const renderOptions = () => {\n    const style = {\n      height: `${itemHeight}px`,\n      lineHeight: `${itemHeight}px`\n    };\n    return state.options.map((option, index: number) => {\n      const text: string | PickerOption = getOptionText(option);\n      const disabled = isOptionDisabled(option);\n\n      const data = {\n        role: 'button',\n        key: index,\n        style,\n        tabIndex: disabled ? -1 : 0,\n        className: props.classnames(`PickerColumns-columnItem`, {\n          'is-disabled': disabled,\n          'is-selected': index === state.index\n        }),\n        onClick: () => {\n          onClickItem(index);\n        }\n      };\n\n      const childData = {\n        className: 'text-ellipsis',\n        children: text\n      };\n\n      return (\n        <li {...data} ref={menuItemRef}>\n          {props.optionRender ? (\n            props.optionRender(option)\n          ) : (\n            <div {...childData} />\n          )}\n        </li>\n      );\n    });\n  };\n\n  const setValue = (value: string) => {\n    const {options} = state;\n    for (let i = 0; i < options.length; i += 1) {\n      if (options[i] === value) {\n        return setIndex(i);\n      }\n    }\n    return null;\n  };\n\n  const getValue = useCallback<() => PickerOption>(\n    () => state.options[state.index],\n    [state.index, state.options]\n  );\n\n  useEffect(() => {\n    setIndex(defaultIndex);\n  }, [defaultIndex]);\n\n  useUpdateEffect(() => {\n    setOptions(cloneDeep(options));\n  }, [options]);\n\n  useImperativeHandle(ref, () => ({\n    state,\n    setIndex,\n    getValue,\n    setValue,\n    setOptions,\n    stopMomentum\n  }));\n\n  const wrapperStyle = {\n    transform: `translate3d(0, ${state.offset + baseOffset}px, 0)`,\n    transitionDuration: `${state.duration}ms`,\n    transitionProperty: state.duration ? 'all' : 'none'\n  };\n  return (\n    <div\n      ref={root}\n      className={props.classnames('PickerColumns', props.className)}\n      onTouchStart={onTouchStart}\n      onTouchMove={onTouchMove}\n      onTouchEnd={onTouchEnd}\n      onTouchCancel={onTouchEnd}\n    >\n      <ul\n        ref={wrapper}\n        style={wrapperStyle}\n        className={props.classnames('PickerColumns-columnWrapper')}\n        onTransitionEnd={stopMomentum}\n      >\n        {renderOptions()}\n      </ul>\n    </div>\n  );\n});\n\nPickerColumn.defaultProps = {\n  options: [],\n  visibleItemCount: 5,\n  swipeDuration: 1000,\n  itemHeight: 48\n};\n\nexport default themeable(\n  uncontrollable(PickerColumn, {\n    value: 'onChange'\n  })\n);\n"
    ]
}