---
title: æ•°æ®åŸŸä¸æ•°æ®é“¾
description:
type: 0
group: ğŸ’¡ æ¦‚å¿µ
menuName: æ•°æ®åŸŸä¸æ•°æ®é“¾
icon:
order: 10
---

## åŸºæœ¬çš„æ•°æ®å±•ç¤º

æˆ‘ä»¬å†çœ‹ä¹‹å‰çš„ç®€å•ç¤ºä¾‹ï¼š

```json
{
  "type": "page",
  "body": "Hello World!"
}
```

ç›®å‰æˆ‘ä»¬åªæ˜¯åœ¨ `Page` ç»„ä»¶ä¸­æ¸²æŸ“ä¸€ä¸²å›ºå®šçš„æ–‡æœ¬ï¼Œå¦‚ä½•å®ç° **é€šè¿‡æ¥å£æ‹‰å–æƒ³è¦çš„æ•°æ®ï¼Œå¹¶å±•ç¤ºåˆ° `Page` ç»„ä»¶çš„å†…å®¹åŒº** å‘¢ï¼Ÿ

## æ·»åŠ åˆå§‹åŒ–æ¥å£

```json
{
  "type": "page",
  "initApi": "/api/mock2/page/initData",
  "body": "date is ${date}"
}
```

è¿™ä¸ª api æ¥å£è¿”å›çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š

```json
{
  "status": 0,
  "msg": "",
  "data": {
    "title": "Test Page Component",
    "date": "2017-10-13"
  }
}
```

æ¸²æŸ“åé¡µé¢æ•ˆæœï¼š

```schema
{
  "type": "page",
  "initApi": "/api/mock2/page/initData",
  "body": "date is ${date}"
}
```

## å‘ç”Ÿäº†ä»€ä¹ˆ?

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¾“å‡ºç»“æœä¸å˜ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™æ¬¡æ¸²æŸ“çš„æ˜¯æ¥å£è¿”å›çš„æ•°æ®ï¼š

1. é¦–å…ˆæˆ‘ä»¬ç»™ `Page` ç»„ä»¶é…ç½®äº†`initApi`å±æ€§ï¼Œè¯¥å±æ€§ä¼šåœ¨ç»„ä»¶åˆå§‹åŒ–æ—¶ï¼Œè¯·æ±‚æ‰€è¯¥å±æ€§æ‰€é…ç½®çš„æ¥å£
2. æ¥å£è¯·æ±‚æˆåŠŸåï¼Œ`Page` ä¼šæŠŠæ¥å£è¿”å›çš„`data`å†…æ•°æ®å­˜åˆ°å½“å‰çš„æ•°æ®åŸŸä¸­
3. `Page` åœ¨æ¸²æŸ“ `body` æ‰€é…ç½®çš„æ–‡æœ¬æ—¶ï¼Œä¼šè§£ææ–‡æœ¬å†…å®¹ï¼Œå½“è§£æåˆ°æ¨¡æ¿å˜é‡`${text}`æ—¶ï¼Œamis ä¼šæŠŠå°è¯•åœ¨å½“å‰ç»„ä»¶çš„æ•°æ®åŸŸä¸­è·å–`text`å˜é‡å€¼ï¼Œå¹¶æ›¿æ¢æ‰`${text}`ï¼Œæœ€åæ¸²æŸ“è§£æåçš„æ–‡æœ¬ã€‚

> ä¸‹ä¸€èŠ‚æˆ‘ä»¬ä¼šä»‹ç»[æ¨¡æ¿](./template)ï¼Œ`body`å±æ€§è‡ªèº«æ”¯æŒæ¨¡æ¿è¯­æ³•ï¼Œamis ä¸­æ”¯æŒæ¨¡æ¿è¯­æ³•çš„ç»„ä»¶è¿˜æœ‰å¾ˆå¤š

## æ•°æ®åŸŸ

å‰é¢æˆ‘ä»¬æåˆ°äº†**æ•°æ®åŸŸ**è¿™ä¸ªæ¦‚å¿µï¼Œå®ƒæ˜¯ amis ä¸­æœ€é‡è¦çš„æ¦‚å¿µä¹‹ä¸€ã€‚

è¿˜æ˜¯é€šè¿‡æœ€ç®€å•çš„ç¤ºä¾‹è¿›è¡Œè®²è§£ï¼š

```json
{
  "type": "page",
  "body": "Hello ${text}"
}
```

ä¸Šé¢çš„é…ç½®è¦åšçš„å¾ˆç®€å•ï¼šä½¿ç”¨ `Page` ç»„ä»¶ï¼Œåœ¨å†…å®¹åŒºå†…æ¸²æŸ“ä¸€æ®µæ¨¡æ¿æ–‡å­—ï¼Œå…¶ä¸­`${text}`æ˜¯**æ¨¡æ¿å˜é‡**ï¼Œå®ƒä¼šå»åˆ°å½“å‰ç»„ä»¶çš„æ•°æ®åŸŸä¸­ï¼Œè·å–`text`å˜é‡å€¼ã€‚

æ¯«æ— ç–‘é—®ï¼Œ`${text}`å°†ä¼šè§£æä¸ºç©ºç™½æ–‡æœ¬ï¼Œæœ€ç»ˆæ¸²æŸ“çš„æ–‡æœ¬æ˜¯ `Hello`

```schema
{
  "type": "page",
  "body": "Hello ${text}"
}
```

å› ä¸ºå½“å‰ `Page` ç»„ä»¶çš„æ•°æ®åŸŸä¸­æ˜¯æ²¡æœ‰ä»»ä½•æ•°æ®çš„ï¼Œç›¸æ¯”ä¹‹å‰çš„ç¤ºä¾‹ï¼ŒåŒºåˆ«åœ¨äºå‰é¢æˆ‘ä»¬ä¸º `Page` ç»„ä»¶é…ç½®äº†åˆå§‹åŒ–æ¥å£ï¼Œå®ƒä¼šå°†æ¥å£è¿”å›çš„æ•°æ®å­˜å…¥æ•°æ®åŸŸä¸­ä»¥ä¾›ç»„ä»¶ä½¿ç”¨ã€‚

å†è§‚å¯Ÿä¸‹é¢è¿™æ®µé…ç½®ï¼š

```schema
{
  "data": {
    "text": "World!"
  },
  "type": "page",
  "body": "Hello ${text}"
}
```

å†æ¬¡æŸ¥çœ‹æ¸²æŸ“ç»“æœï¼Œé¡ºåˆ©è¾“å‡ºäº† `Hello World!`

ç›¸ä¿¡ä½ å¯èƒ½å·²ç»çŒœåˆ°ï¼Œ**ç»„ä»¶çš„`data`å±æ€§å€¼æ˜¯æ•°æ®åŸŸçš„ä¸€ç§å½¢å¼**ï¼Œå®é™…ä¸Šå½“æˆ‘ä»¬æ²¡æœ‰æ˜¾å¼çš„é…ç½®æ•°æ®åŸŸæ—¶ï¼Œå¯ä»¥å‡æƒ³æˆè¿™æ ·ï¼š

```schema
{
  "data": {}, // ç©ºçš„æ•°æ®åŸŸ
  "type": "page",
  "body": "Hello ${text}"
}
```

> è€Œå‰é¢æˆ‘ä»¬çŸ¥é“ amis çš„ç‰¹æ€§ä¹‹ä¸€æ˜¯åŸºäºç»„ä»¶æ ‘ï¼Œå› æ­¤è‡ªç„¶æ•°æ®åŸŸä¹Ÿä¼šå½¢æˆç±»ä¼¼äºæ ‘å‹ç»“æ„ï¼Œå¦‚ä½•æ¥å¤„ç†è¿™äº›æ•°æ®åŸŸä¹‹é—´çš„è”ç³»å‘¢ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬é©¬ä¸Šè¦ä»‹ç»åˆ°çš„ **[æ•°æ®é“¾](./datascope-and-datachain#%E6%95%B0%E6%8D%AE%E9%93%BE)**

## æ•°æ®é“¾

ç›¸ä¿¡é€šè¿‡ä¸Šæ–‡ï¼Œä½ å·²ç»åŸºæœ¬æŒæ¡äº† amis ä¸­æ•°æ®åŸŸçš„æ¦‚å¿µï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¼šä»‹ç»å¦ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼š**æ•°æ®é“¾**ã€‚

**æ•°æ®é“¾**çš„ç‰¹æ€§æ˜¯ï¼Œå½“å‰ç»„ä»¶åœ¨é‡åˆ°è·å–å˜é‡çš„åœºæ™¯ï¼ˆä¾‹å¦‚æ¨¡æ¿æ¸²æŸ“ã€å±•ç¤ºè¡¨å•æ•°æ®ã€æ¸²æŸ“åˆ—è¡¨ç­‰ç­‰ï¼‰æ—¶ï¼š

1. é¦–å…ˆä¼šå…ˆå°è¯•åœ¨å½“å‰ç»„ä»¶çš„æ•°æ®åŸŸä¸­å¯»æ‰¾å˜é‡ï¼Œå½“æˆåŠŸæ‰¾åˆ°å˜é‡æ—¶ï¼Œé€šè¿‡æ•°æ®æ˜ å°„å®Œæˆæ¸²æŸ“ï¼Œåœæ­¢å¯»æ‰¾è¿‡ç¨‹ï¼›
2. å½“åœ¨å½“å‰æ•°æ®åŸŸä¸­æ²¡æœ‰æ‰¾åˆ°å˜é‡æ—¶ï¼Œåˆ™å‘ä¸Šå¯»æ‰¾ï¼Œåœ¨çˆ¶ç»„ä»¶çš„æ•°æ®åŸŸä¸­ï¼Œé‡å¤æ­¥éª¤`1`å’Œ`2`ï¼›
3. ä¸€ç›´å¯»æ‰¾ï¼Œç›´åˆ°é¡¶çº§èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯`page`èŠ‚ç‚¹ï¼Œå¯»æ‰¾è¿‡ç¨‹ç»“æŸã€‚
4. ä½†æ˜¯å¦‚æœ url ä¸­æœ‰å‚æ•°ï¼Œè¿˜ä¼šç»§ç»­å‘ä¸ŠæŸ¥æ‰¾è¿™å±‚ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™é…ç½®ä¸­å¯ä»¥ç›´æ¥ `${id}` å–åœ°å€æ å‚æ•°ã€‚

> ä¸ºäº†æ–¹ä¾¿è®²è§£ï¼Œæˆ‘ä»¬è¿™ä¸€ç« çš„ä¾‹å­ç»Ÿä¸€ä½¿ç”¨çš„è®¾ç½®ç»„ä»¶`data`å±æ€§çš„æ–¹å¼æ¥åˆå§‹åŒ–æ•°æ®åŸŸï¼Œè¯·è®°ä½ï¼Œå¦‚æœç»„ä»¶æ”¯æŒï¼Œä½ æ°¸è¿œå¯ä»¥é€šè¿‡æ¥å£æ¥è¿›è¡Œæ•°æ®åŸŸçš„åˆå§‹åŒ–

ç»§ç»­æ¥çœ‹è¿™ä¸ªä¾‹å­ï¼š

```schema
{
  "type": "page",
  "data": {
    "name": "zhangsan",
    "age": 20
  },
  "body": [
    {
      "type": "tpl",
      "tpl": "my name is ${name}"
    },
    {
      "type": "service",
      "data": {
        "name": "lisi"
      },
      "body":  {
        "type": "tpl",
        "tpl": "my name is ${name}, I'm ${age} years old"
      }
    }
  ]
}
```

ä¸Šé¢çš„é…ç½®é¡¹å½¢æˆäº†å¦‚ä¸‹çš„ç»„ä»¶æ ‘å’Œæ•°æ®é“¾ï¼š

ç»„ä»¶æ ‘ï¼š

```
page
  â”œâ”€ tpl
  â””â”€ service
       â””â”€ tpl
```

æ•°æ®é“¾ï¼š

```json
{
  "name": "zhangsan",
  "age": 20,
  "__sub": {
    "name": "lisi"
  }
}
```

> `__sub` å­—æ®µåªæ˜¯ä¸ºäº†æ–¹ä¾¿ç†è§£ã€‚

é¦–å…ˆï¼Œ`page`ç»„ä»¶ä¸‹çš„`tpl`ç»„ä»¶ï¼Œåœ¨æ¸²æŸ“`my name is ${name}`æ—¶ï¼Œé¦–å…ˆä¼šåœ¨`page`çš„æ•°æ®åŸŸä¸­ï¼Œå°è¯•å¯»æ‰¾`name`å˜é‡ï¼Œåœ¨å½“å‰æ•°æ®åŸŸä¸­ï¼Œ`name`å˜é‡ä¸º`zhangsan`ï¼Œå› æ­¤å¯»æ‰¾å˜é‡ç»“æŸï¼Œé€šè¿‡æ•°æ®æ˜ å°„æ¸²æŸ“ï¼Œè¾“å‡ºï¼š`my name is zhangsan`ï¼Œæ¸²æŸ“ç»“æŸï¼›

ç„¶åï¼Œ`service`ç»„ä»¶å¼€å§‹æ¸²æŸ“ï¼Œ`service`ç»„ä»¶å†…å­ç»„ä»¶`tpl`ï¼Œå®ƒé…ç½®çš„æ¨¡æ¿å­—ç¬¦ä¸²æ˜¯ï¼š`my name is ${name}, I'm ${age} years old`ï¼Œå®ƒä¼šåœ¨`service`çš„æ•°æ®åŸŸä¸­ï¼Œå°è¯•å¯»æ‰¾`name`å’Œ`age`å˜é‡ã€‚

ç”±ä»£ç å¯ä»¥çœ‹å‡ºï¼Œ`service`æ•°æ®åŸŸä¸­`name`å˜é‡ä¸º`lisi`ï¼Œå› æ­¤åœæ­¢è¯¥å˜é‡çš„å¯»æ‰¾ï¼Œæ¥ä¸‹æ¥å¯»æ‰¾`age`å˜é‡ã€‚

å¾ˆæ˜æ˜¾åœ¨`service`æ•°æ®åŸŸä¸­å¯»æ‰¾`age`å˜é‡ä¼šå¤±è´¥ï¼Œå› æ­¤å‘ä¸ŠæŸ¥æ‰¾ï¼Œå°è¯•åœ¨`page`æ•°æ®åŸŸä¸­å¯»æ‰¾`age`å˜é‡ï¼Œæ‰¾åˆ°ä¸º`20`ï¼Œå¯»æ‰¾å˜é‡ç»“æŸï¼Œé€šè¿‡æ•°æ®æ˜ å°„æ¸²æŸ“ï¼Œè¾“å‡ºï¼š`my name is lisi, I'm 20 years old`ï¼Œæ¸²æŸ“ç»“æŸã€‚

> **æ³¨æ„ï¼š** å½“å‰ä¾‹å­ä¸­ï¼Œå¯¹æ•°æ®åŸŸä¸­æ•°æ®çš„è·å–ä½¿ç”¨çš„æ˜¯ **\${xxx}** æ¨¡æ¿è¯­æ³•ï¼Œä½†æ˜¯åœ¨ä¸åŒçš„ç»„ä»¶é…ç½®é¡¹ä¸­ï¼Œè·å–æ•°æ®çš„è¯­æ³•ä¼šæœ‰å·®å¼‚ï¼Œæˆ‘ä»¬ä¼šåœ¨åç»­çš„[æ¨¡æ¿](./template)å’Œ[è¡¨è¾¾å¼ç« èŠ‚](./expression)ä¸­ä¸€ä¸€ä»‹ç»ã€‚

### å…·å¤‡æ•°æ®åŸŸçš„ç»„ä»¶

- App
- Page
- Cards
- Chart
- CRUD
- CRUD2
- Dialog
- Drawer
- List
- Form
- PaginationWrapper
- Service
- Wizard
- Combo
- InputArray
- Table
- Table2

æœ‰ä¸ªç‰¹æ®Šæƒ…å†µæ˜¯ CRUD ä¸­ filterï¼Œå®é™…ä¸Šæ˜¯ä¸ª formï¼Œæ‰€ä»¥ CRUD ä¸­æœ‰ä¸¤å±‚æ•°æ®åŸŸï¼Œç¬¬ä¸€å±‚æ˜¯ CRUD æœ¬èº«ï¼ŒåŒæ—¶æŸ¥è¯¢æ¡ä»¶è¡¨å•ä¸­ä¹Ÿæœ‰ä¸€å±‚æ•°æ®åŸŸã€‚

### å¸¸è§è¯¯è§£

éœ€è¦æ³¨æ„ï¼Œåªæœ‰å°‘æ•°å‡ ä¸ªå®¹å™¨ç»„ä»¶ä¼šåˆ›å»ºæ–°çš„æ•°æ®åŸŸï¼Œå…·ä½“æŸ¥çœ‹[å…·å¤‡æ•°æ®åŸŸçš„ç»„ä»¶](#å…·å¤‡æ•°æ®åŸŸçš„ç»„ä»¶)åˆ—è¡¨ã€‚

å¸¸è§çš„é”™è¯¯å†™æ³•æ˜¯ç»™å®¹å™¨ç»„ä»¶åŠ  data å±æ€§ï¼Œæ¯”å¦‚ï¼š

```schema
{
  "type": "page",
  "data": {
    "name": "zhangsan"
  },
  "body": [
    {
      "type": "tpl",
      "tpl": "my name is ${name}"
    },
    {
      "type": "container",
      "data": {
        "name": "lisi"
      },
      "body":  {
        "type": "tpl",
        "tpl": "my name is ${name}"
      }
    }
  ]
}
```

è¿™æ ·æ˜¯ä¸ä¼šç”Ÿæ•ˆçš„ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯ä½¿ç”¨ Service åŒ…è£¹ä¸€å±‚ï¼Œå¦‚ä¸‹æ‰€ç¤º

```schema
{
  "type": "page",
  "data": {
    "name": "zhangsan"
  },
  "body": [
    {
      "type": "tpl",
      "tpl": "my name is ${name}"
    },
    {
      "type": "service",
      "data": {
        "name": "lisi"
      },
      "body": {
        "type": "container",
        "body":  {
          "type": "tpl",
          "tpl": "my name is ${name}"
        }
      }
    }
  ]
}
```

## åˆå§‹åŒ–æ•°æ®åŸŸ

é€šè¿‡ä¸Šé¢çš„ä»‹ç»ä½ å¯èƒ½å‘ç°ï¼Œåˆå§‹åŒ–æ•°æ®åŸŸæœ‰ä¸¤ç§æ–¹å¼ï¼š

### 1. é…ç½®ç»„ä»¶åˆå§‹åŒ–æ¥å£

æƒ³è¦å°†è‡ªå·±çš„æœåŠ¡ä¸­çš„æ•°æ®ä¿å­˜åˆ°æŸä¸ªç»„ä»¶çš„æ•°æ®åŸŸä¸­ï¼Œæœ€å¥½çš„æ–¹å¼å°±æ˜¯ä¸ºå½“å‰ç»„ä»¶é…ç½®åˆå§‹åŒ–æ¥å£ï¼š

```json
{
  "type": "page",
  "initApi": "/api/initData",
  "body": "Hello ${text}"
}
```

æ¥å£å¿…é¡»æŒ‰ç…§ä¸‹é¢çš„æ ¼å¼è¿”å›ï¼š

```json
{
  "status": 0,
  "msg": "",
  "data": {
    "text": "World!"
    ...å…¶ä»–å­—æ®µ
  }
}
```

**æ³¨æ„ï¼š**

1. **å¹¶ä¸æ˜¯æ‰€æœ‰ç»„ä»¶éƒ½æ”¯æŒé…ç½®åˆå§‹åŒ–æ¥å£æ¥å®ç°æ•°æ®åŸŸåˆå§‹åŒ–æ“ä½œ**ï¼Œå¯¹äºé‚£äº›ä¸æ”¯æŒé…ç½®åˆå§‹åŒ–æ¥å£çš„ç»„ä»¶æ¥è¯´ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨ [**Service ç»„ä»¶**](../../components/service) æ¥è¾…åŠ©å®ç°æ•°æ®åŸŸåˆå§‹åŒ–ï¼›
2. **`status`**ã€**`msg`** å’Œ **`data`** å­—æ®µä¸ºæ¥å£è¿”å›çš„å¿…è¦å­—æ®µï¼›
3. `data`å¿…é¡»è¿”å›ä¸€ä¸ªå…·æœ‰`key-value`ç»“æ„çš„å¯¹è±¡

```json
{
  "status": 0,
  "msg": "",
  "data": { // æ­£ç¡®
    "text": "World!"
  }
}

// ç›´æ¥è¿”å›å­—ç¬¦ä¸²æˆ–è€…æ•°ç»„éƒ½æ˜¯æ— æ•ˆçš„
{
  "status": 0,
  "msg": "",
  "data": "some string" // é”™è¯¯ï¼Œä½¿ç”¨ key åŒ…è£…
}
{
  "status": 0,
  "msg": "",
  "data": ["a", "b"] // é”™è¯¯ï¼Œä½¿ç”¨ key åŒ…è£…
}
```

> `api` é™¤äº†é…ç½®å­—ç¬¦ä¸²æ ¼å¼ä»¥å¤–ï¼Œè¿˜å¯ä»¥é…ç½®å¤æ‚å¯¹è±¡ç»“æ„ï¼Œæ›´å¤šè¯¦æƒ…æŸ¥çœ‹[API æ–‡æ¡£](../types/api)

### 2. æ˜¾å¼é…ç½® data å±æ€§å€¼

å¦ä¸€ç§åˆå§‹åŒ–å½“å‰æ•°æ®åŸŸçš„æ–¹å¼æ˜¯æ˜¾å¼çš„è®¾ç½®ç»„ä»¶çš„`data`å±æ€§å€¼ï¼š

```schema
{
  "data": {
    "text": "World!",
    "name": "amis"
  },
  "type": "page",
  "body": "Hello ${text}, my name is ${name}."
}
```

### åŒæ—¶é…ç½®

åœ¨åŒæ—¶é…ç½® **åˆå§‹åŒ–æ¥å£** å’Œ **`data`å±æ€§** æ—¶ï¼Œæ•°æ®åŸŸå°†ä¼šåˆå¹¶`data`å±æ€§å€¼å’Œåˆå§‹åŒ–æ¥å£è¿”å›çš„æ•°æ®

## æ›´æ–°æ•°æ®åŸŸ

éƒ¨åˆ†ç»„ä»¶çš„æŸäº›äº¤äº’æˆ–è¡Œä¸ºä¼šå¯¹å½“å‰ç»„ä»¶çš„æ•°æ®åŸŸè¿›è¡Œæ›´æ–°ï¼š

```schema
{
  "type": "page",
  "body": {
    "type": "form",
    "api": "/api/mock2/form/saveForm",
    "body": [
      {
        "type": "input-text",
        "name": "name",
        "label": "å§“åï¼š"
      },
      {
        "type": "input-text",
        "name": "age",
        "label": "å¹´é¾„ï¼š"
      },
      {
        "type": "static-tpl",
        "tpl": "ç”Ÿæˆçš„idä¸ºï¼š${id}"
      }
    ]
  }
}
```

`/api/saveForm`æ¥å£ä¼šä¿å­˜å½“å‰è¡¨å•æäº¤çš„æ•°æ®ï¼Œå¹¶è¿”å›åç«¯æœåŠ¡ç”Ÿæˆçš„`id`ï¼Œå¹¶è¿”å›åˆ°å‰ç«¯ï¼Œæ ¼å¼å¦‚ä¸‹;

```json
{
  "status": 0,
  "msg": "ä¿å­˜æˆåŠŸ",
  "data": {
    "id": 1
  }
}
```

è¿™æ—¶ amis å°†ä¼šæŠŠ`data`æ•°æ®ä¸å½“å‰`form`ç»„ä»¶çš„æ•°æ®åŸŸè¿›è¡Œ**merge**ï¼Œ`form`ç»„ä»¶ä¸­çš„`static-tpl`ç»„ä»¶ä¼šæ ¹æ®æ›´æ–°åçš„æ•°æ®åŸŸï¼Œæ˜¾ç¤º`id`ä¸º`1`ã€‚

> å…·æœ‰ç±»ä¼¼ç‰¹å¾çš„ç»„ä»¶è¿˜æœ‰`Formula`ç­‰

## æ›´æ–°æ•°æ®é“¾

é€šå¸¸é¡¶å±‚æ•°æ®åŸŸæ•°æ®æ›´æ–°ï¼Œå­©å­ä¸­å…·å¤‡æ•°æ®åŸŸçš„ç»„ä»¶éƒ½ä¼šæ›´æ–°ï¼Œå¦‚æœä¸æ›´æ–°ä¼šæ‹¿ä¸åˆ°æœ€æ–°çš„å€¼ã€‚ä»åŠŸèƒ½æ¥çœ‹è¿™ä¸ªæ›´æ–°ä»£ä»·å…¶å®æ˜¯å¾ˆå¤§çš„ï¼Œæœ‰æ€§èƒ½æŸè€—ï¼Œæ¯”å¦‚å¦‚æœæˆ‘åœ¨é¡¶å±‚æ›´æ–°äº†ä¸ªå˜é‡ `name`ï¼Œæ‰€æœ‰çš„å­©å­éƒ½ä¼šé‡æ–°åˆ·æ–°ä¸€éã€‚
ç›®å‰ amis ä¸­ï¼Œå…·å¤‡æ•°æ®åŸŸçš„ç»„ä»¶ï¼Œé»˜è®¤ä¼šæ£€æµ‹ä¸¤å±‚èŠ‚ç‚¹çš„æ•°æ®æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼ˆä¸Šå±‚æ•°æ®åŸŸå’Œä¸Šä¸Šå±‚æ•°æ®åŸŸï¼‰ï¼Œæ¥å†³å®šå½“å‰å±‚çš„æ•°æ®è¦ä¸è¦æ›´æ–°ã€‚å­˜åœ¨ä¸¤ä¸ªé—®é¢˜ï¼š

1. å½“å‰ç»„ä»¶ä¹Ÿè®¸å¹¶ä¸å…³å¿ƒä¸Šå±‚æ•°æ®æ˜¯å¦å˜åŒ–ï¼Œæ²¡å¿…è¦è¿›è¡Œè¿™äº›åˆ·æ–°æ“ä½œ
2. å½“å‰ç»„ä»¶å…³å¿ƒä¸Šä¸Šå±‚çš„æ•°æ®å˜åŒ–ï¼Œä½†æ˜¯åœ¨æ­¤æ‹¿ä¸åˆ°æœ€æ–°çš„ã€‚ï¼ˆæ¯”å¦‚ï¼šæ”¾åœ¨ service ä¸­çš„ crudï¼Œcrud ä¸­ filter ç”¨äº† service çš„æ¥å£è¿”å›æ•°æ®ï¼Œä½†æ˜¯æ‹¿ä¸åˆ°æœ€æ–°çš„ï¼‰

amis ä» 3.2.0 ç‰ˆæœ¬å¼€å§‹é’ˆå¯¹[å…·å¤‡æ•°æ®åŸŸçš„ç»„ä»¶](#å…·å¤‡æ•°æ®åŸŸçš„ç»„ä»¶)æ–°å¢äº† `trackExpression` å±æ€§ï¼Œç”¨æ¥ä¸»åŠ¨é…ç½®å½“å‰ç»„ä»¶éœ€è¦å…³å¿ƒçš„ä¸Šå±‚æ•°æ®ã€‚

é’ˆå¯¹ä»¥ä¸Šé—®é¢˜ï¼Œåˆ™å¯ä»¥é€šè¿‡è¿™æ ·é…ç½®æ¥è§£å†³

1.  `trackExpression` é…ç½®æˆ `"none"` ä¹Ÿå°±æ˜¯è¯´ä¸è¿½è¸ªä»»ä½•æ•°æ®ã€‚
2.  `trackExpression` é…ç½®æˆ `"${xxxVariable}"` è¿™æ · xxxVariable å˜åŒ–äº†æ›´æ–°å½“å‰ç»„ä»¶çš„æ•°æ®é“¾ã€‚

å…³äº `trackExpression` çš„è¯­æ³•ï¼Œè¯·æŸ¥çœ‹è¡¨è¾¾å¼ç¯‡ç« ï¼Œå¯ä»¥ç›‘å¬å¤šä¸ªå˜é‡æ¯”å¦‚: `"${xxx1},${xxx2}"`ï¼Œè¿˜å¯ä»¥å†™è¡¨è¾¾å¼å¦‚ `"${ xxx ? xxx : yyy}"`ã€‚

amis å†…éƒ¨æ˜¯é€šè¿‡è¿ç®—è¿™ä¸ªè¡¨è¾¾å¼çš„ç»“æœæ¥åˆ¤æ–­ã€‚æ‰€ä»¥è¡¨è¾¾å¼ä¸­åƒä¸‡ä¸è¦ç”¨éšæœºå‡½æ•°ï¼Œæˆ–è€…ç”¨å½“å‰æ—¶é—´ç­‰ï¼Œå¦åˆ™æ¯æ¬¡éƒ½ä¼šæ›´æ–°æ•°æ®é“¾ã€‚å¦å¤–å¦‚æœå˜é‡æ˜¯æ•°ç»„ï¼Œæˆ–è€…å¯¹è±¡ï¼Œä¼šè½¬æˆç»Ÿä¸€çš„å­—ç¬¦ä¸² `[object Array]` æˆ–è€… `[object Object]` è¿™ä¸ªå…¶å®ä¼šå½±å“æ£€æµ‹çš„ï¼Œæ‰€ä»¥å»ºè®®è½¬æˆ json å­—ç¬¦ä¸²å¦‚ã€‚ `${xxxObject | json}`ã€‚è¿˜æœ‰å°±æ˜¯æ—¢ç„¶æ˜¯ç›‘æ§ä¸Šå±‚æ•°æ®ï¼Œè¡¨è¾¾å¼ä¸­ä¸è¦å†™å½“å‰å±‚æ•°æ®å˜é‡ï¼Œæ˜¯å–ä¸åˆ°çš„ã€‚

```schema
{
  "data": {
    "name": "amis"
  },
  "type": "page",
  "body": [
    { "label": "è¯·ä¿®æ”¹è¾“å…¥æ¡†", "type": "input-text", "name": "name"},
    {
      "type": "switch",
      "label": "åŒæ­¥æ›´æ–°",
      "name": "syncSwitch"
    },
    {
      "type": "crud",
      "filter": {
        "trackExpression": "${syncSwitch ? name : ''}",
        "body": [


          "my name is ${name}"
        ]
      }
    }
  ]
}
```

## URL å‚æ•°

url ä¸­çš„å‚æ•°ä¼šè¿›å…¥é¡¶å±‚æ•°æ®åŸŸï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ï¼Œå¯ä»¥ç‚¹å‡»[è¿™é‡Œ](./datascope-and-datachain?word=myquery#url-å‚æ•°)çœ‹æ•ˆæœã€‚

```schema
{
  "type": "page",
  "body": "${word}"
}
```

## éšè—æ•°æ®

æ•°æ®ä¸­è¿˜æœ‰ä»¥ä¸‹å­—æ®µä¸ä¼šè¢«æšä¸¾åˆ°ï¼Œä½†æ˜¯å¯ä»¥è¯»å–ï¼š

- `__prev` ä¿®æ”¹å‰çš„å€¼
- `__changeReason` ä¿®æ”¹åŸå› 
- `__changeReason.type` ä¿®æ”¹åŸå› ç±»å‹
  - `input` ç”¨æˆ·è¾“å…¥
  - `api` api æ¥å£è¿”å›è§¦å‘
  - `formula` å…¬å¼è®¡ç®—è§¦å‘
  - `hide` éšè—å±æ€§å˜åŒ–è§¦å‘
  - `init` è¡¨å•é¡¹åˆå§‹åŒ–è§¦å‘
  - `action` äº‹ä»¶åŠ¨ä½œè§¦å‘
- `__super` æ•°æ®é“¾çš„ä¸Šä¸€çº§

> `__changeReason` å­—æ®µåœ¨ amis 6.9.0 ç‰ˆæœ¬å¼€å§‹æ”¯æŒ

```schema
{
  "data": {
    "name": "amis"
  },
  "type": "form",
  id: "form_data",
  "actions": [
    {
      type: "button",
      label: "æ¥å£è·å–",
      actionType: "ajax",
      api: {
        "method": "get",
        url: "/api/mock2/form/saveForm",
        mockResponse: {
          status: 200,
          data: {
            name: "amis-demo"
          }
        }
      }
    },

    {
      type: "button",
      label: "è®¾ç½®å€¼",
      onEvent: {
        click: {
          actions: [
            {
              "actionType": "setValue",
              "componentId": "form_data",
              "args": {
                "value": {
                  "name": "amis-demo2"
                }
              }
            }
          ]
        }
      }
    },
  ],
  "body": [
    {
      type: "input-text",
      name: "name",
      label: "å§“å"
    },
    {
      type: "tpl",
      tpl: "å½“å‰å€¼ï¼š${name}<br />ä¿®æ”¹å‰çš„å€¼ï¼š${__prev.name}<br />å˜åŒ–åŸå› ï¼š${__changeReason|json}"
    }
  ]
}
```
